(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"/2RN":function(e,t,o){"use strict";o.r(t),o.d(t,"DashboardPageModule",(function(){return H}));var i=o("Valr"),n=o("QJY3"),r=o("DUip"),s=o("sPEm"),c=o("o8Qb"),d=o("j1ZV"),a=o("iTUp"),l=o("mrSG"),p=o("jdDG"),h=o("K9Ia"),g=o("ny24"),u=o("QUi+"),b=o("uu52"),v=o("axIi"),m=o("HgyY"),f=o("Z8WZ"),C=o("/MTl"),k=o("TYT/"),w=o("2MiI"),x=o("A8Lc"),y=o("N79n"),D=o("3EyP");function L(e,t){1&e&&k.Ob(0,"ion-icon",18)}var S=function(e){return{index:e}};function O(e,t){if(1&e){var o=k.Tb();k.Sb(0,"app-group",16),k.ac("showChange",(function(e){k.qc(o);var t=k.dc().$implicit;return k.dc(4).showChange("groups",t.key,e)}))("onRemove",(function(){k.qc(o);var e=k.dc(3).index,t=k.dc().index,i=k.dc();return i.onClickRemove(t*i.rows+e)})),k.wc(1,L,1,0,"ion-icon",17),k.Rb()}if(2&e){var i=k.dc().$implicit,n=k.dc(2).index,r=k.dc().index,s=k.dc();k.ic("cdkDragData",k.lc(9,S,r*s.rows+n))("dashboardRemove",s.reorder)("cdkDragDisabled",!s.reorder)("showRemove",!1)("group",s.groupList[i.key])("reorder",s.reorder)("active",s.active)("show",null==s.settings||null==s.settings.dashboardPage?null:s.settings.dashboardPage.groups[i.key]),k.Ab(1),k.ic("ngIf",s.reorder)}}function R(e,t){1&e&&k.Ob(0,"ion-icon",18)}function P(e,t){if(1&e){var o=k.Tb();k.Sb(0,"app-room",19),k.ac("showChange",(function(e){k.qc(o);var t=k.dc().$implicit;return k.dc(4).showChange("rooms",t.key,e)}))("onRemove",(function(){k.qc(o);var e=k.dc(3).index,t=k.dc().index,i=k.dc();return i.onClickRemove(t*i.rows+e)})),k.wc(1,R,1,0,"ion-icon",17),k.Rb()}if(2&e){var i=k.dc().$implicit,n=k.dc(2).index,r=k.dc().index,s=k.dc();k.ic("dashboardRemove",s.reorder)("cdkDragData",k.lc(9,S,r*s.rows+n))("cdkDragDisabled",!s.reorder)("showRemove",!1)("room",s.roomList[i.key])("reorder",s.reorder)("active",s.active)("show",null==s.settings||null==s.settings.dashboardPage?null:s.settings.dashboardPage.rooms[i.key]),k.Ab(1),k.ic("ngIf",s.reorder)}}function I(e,t){if(1&e){var o=k.Tb();k.Qb(0),k.Sb(1,"ion-fab-button",25),k.ac("click",(function(){k.qc(o);var e=k.dc(4).index,t=k.dc().index,i=k.dc();return i.onClickRemove(t*i.rows+e)})),k.Rb(),k.Ob(2,"ion-icon",26),k.Pb()}}function z(e,t){1&e&&k.Ob(0,"ion-icon",29)}function M(e,t){if(1&e&&(k.Sb(0,"app-device",27),k.wc(1,z,1,0,"ion-icon",28),k.Rb()),2&e){k.dc();var o=k.nc(4),i=k.dc().$implicit,n=k.dc(4);k.ic("device",n.deviceList[i.key])("deviceStatus",n.deviceStatusList[i.key.split("_")[0]])("deviceCon",n.deviceConList[i.key.split("_")[0]])("showEdit",!0)("showRemove",!1)("reorder",n.reorder)("sliding",o)("ping",n.active),k.Ab(1),k.ic("ngIf",n.reorder)}}function T(e,t){if(1&e){var o=k.Tb();k.Sb(0,"div",20),k.wc(1,I,3,0,"ng-container",11),k.Sb(2,"ion-card",21),k.Sb(3,"ion-item-sliding",22,23),k.ac("tap",(function(){return k.qc(o),k.nc(4).close()})),k.wc(5,M,2,9,"app-device",24),k.Rb(),k.Rb(),k.Rb()}if(2&e){var i=k.dc().$implicit,n=k.dc(2).index,r=k.dc().index,s=k.dc();k.ic("cdkDragData",k.lc(4,S,r*s.rows+n))("cdkDragDisabled",!s.reorder),k.Ab(1),k.ic("ngIf",s.reorder),k.Ab(4),k.ic("ngIf",s.deviceList[i.key]&&s.deviceList[i.key].name)}}function _(e,t){if(1&e&&(k.Qb(0),k.wc(1,O,2,11,"app-group",13),k.wc(2,P,2,11,"app-room",14),k.wc(3,T,6,6,"div",15),k.Pb()),2&e){var o=t.$implicit,i=k.dc(4);k.Ab(1),k.ic("ngIf","group"===o.type&&i.groupList[o.key]),k.Ab(1),k.ic("ngIf","room"===o.type&&i.roomList[o.key]),k.Ab(1),k.ic("ngIf","device"===o.type&&i.deviceList[o.key])}}function A(e,t){if(1&e&&(k.Qb(0),k.wc(1,_,4,3,"ng-container",12),k.Pb()),2&e){var o=k.dc().index,i=k.dc().index,n=k.dc();k.Ab(1),k.ic("ngForOf",null==n.settings?null:n.settings.dashboardListIndex[i*n.rows+o])}}function E(e,t){if(1&e){var o=k.Tb();k.Sb(0,"ion-row",10),k.ac("cdkDropListDropped",(function(e){k.qc(o);var i=t.index,n=k.dc().index,r=k.dc();return r.onDrop(e,n*r.rows+i)})),k.wc(1,A,2,1,"ng-container",11),k.Rb()}if(2&e){var i=t.index,n=k.dc().index,r=k.dc();k.vc("z-index",r.rows-i)("border",r.reorder?"0.5px dotted lightgray":null),k.jc("id","dash"+(n*r.rows+i)),k.ic("cdkDropListConnectedTo",r.connectedTo)("cdkDropListEnterPredicate",r.allowDrop(n,i)),k.Ab(1),k.ic("ngIf",null==r.settings?null:r.settings.dashboardListIndex[n*r.rows+i])}}var N=function(){return[]};function j(e,t){if(1&e&&(k.Sb(0,"ion-col",8),k.wc(1,E,2,8,"ion-row",9),k.Rb()),2&e){var o=t.index,i=k.dc();k.vc("z-index",i.cols-o),k.Ab(1),k.ic("ngForOf",k.kc(3,N).constructor(i.rows))}}var F=function(){function e(e,t,o,i,n,r,s){var c=this;this.lookupService=e,this.renderer2=t,this.actionSheetController=o,this.popoverService=i,this.translateService=n,this.router=r,this.cdr=s,this.unsubscribe=new h.a,this.deviceList={},this.deviceStatusList={},this.deviceConList={},this.DEVICE_TYPES=m.b,this.groups=[],this.groupList={},this.rooms=[],this.roomList={},this.active=!0,this.calcItemHeightRoom=function(e,t){var o=0;for(var i in c.deviceList)Number(c.deviceList[i].room_id)===Number(e)&&o++;return 48*o+48+20},this.calcItemHeightGroup=function(e,t){return 48*(c.groupList[e].devices.length||0)+48+20}}return e.prototype.ngOnInit=function(){var e=this;this.router.events.pipe(Object(g.a)(this.unsubscribe)).subscribe((function(t){t instanceof r.c&&("/tabs/dashboard"!==t.url?(e.active=!1,e.detectChanges()):(e.active=!0,e.detectChanges()))})),this.settings=this.lookupService.settings,this.calcColsAndRows(),this.lookupService.subGroupList().pipe(Object(g.a)(this.unsubscribe)).subscribe((function(t){e.groupList=t,e.detectChanges()})),this.lookupService.subRoomList().pipe(Object(g.a)(this.unsubscribe)).subscribe((function(t){e.roomList=t,console.log("subRoomList"),e.detectChanges()})),this.lookupService.subDeviceList().pipe(Object(g.a)(this.unsubscribe)).subscribe((function(t){e.deviceList=t,console.log("subDeviceList"),e.detectChanges()})),this.lookupService.subDeviceStatusList().pipe(Object(g.a)(this.unsubscribe)).subscribe((function(t){for(var o in console.log("subDeviceStatusList"),t)e.deviceStatusList[o]=t[o];e.detectChanges()})),this.lookupService.subDeviceConList().pipe(Object(g.a)(this.unsubscribe)).subscribe((function(t){e.deviceConList=JSON.parse(JSON.stringify(t)),console.log("subDeviceConList"),e.detectChanges()})),setTimeout((function(){e.loading=!0,e.detectChanges(),setTimeout((function(){e.loading=!1,e.detectChanges()}),1e3)}),1e3)},e.prototype.ionViewWillEnter=function(){this.calcColsAndRows()},e.prototype.showChange=function(e,t,o){this.settings.dashboardPage[e][t]=o,this.lookupService.setSettings(this.settings)},e.prototype.calcColsAndRows=function(){this.settings=this.lookupService.settings,this.cols=window.innerWidth<540?1:window.innerWidth<720||window.innerWidth<960?2:window.innerWidth<1140?3:4,this.rows=Math.round(this.settings.cells/this.cols),this.detectChanges()},e.prototype.ngOnDestroy=function(){this.unsubscribe.next(),this.unsubscribe.complete()},e.prototype.onDrop=function(e,t){var o=e.item.data||{};void 0!==o.index?(o=o.index,e.previousContainer!==e.container&&(this.settings.dashboardListIndex[t]=[],Object(p.h)(this.settings.dashboardListIndex[o],this.settings.dashboardListIndex[t],e.previousIndex,e.currentIndex))):void 0!==o.type&&void 0!==o.key&&(this.settings.dashboardListIndex[t]=[{type:o.type,key:o.key}],this.settings.dashboardListIndex[t]=JSON.parse(JSON.stringify(this.settings.dashboardListIndex[t]))),this.lookupService.setSettings(this.settings)},e.prototype.onDropTrash=function(e){var t=e.item.data||{};void 0!==t.index&&(this.settings.dashboardListIndex[t=t.index]=[],this.lookupService.setSettings(this.settings))},e.prototype.onClickRemove=function(e){this.settings.dashboardListIndex[e]=[],this.lookupService.setSettings(this.settings)},e.prototype.onDropEnter=function(){var e=document.body.lastElementChild.querySelector("ion-card");this.renderer2.setStyle(e,"border","1px solid red"),this.trash=!0},e.prototype.onDropExit=function(){var e=document.body.lastElementChild.querySelector("ion-card");this.renderer2.removeStyle(e,"border"),this.trash=!1},e.prototype.allowDrop=function(e,t){var o=(this.settings.dashboardListIndex[e*this.rows+t]||[])[0],i=!o;return o&&"group"===o.type&&(i=!this.groupList[o.key]),o&&"room"===o.type&&(i=!this.roomList[o.key]),o&&"device"===o.type&&(i=!this.deviceList[o.key]),function(e,t){return i}},e.prototype.onClickAdd=function(){return Object(l.b)(this,void 0,void 0,(function(){var e=this;return Object(l.e)(this,(function(t){switch(t.label){case 0:return[4,this.actionSheetController.create({header:this.translateService.instant("app.shelly-home.home.customize.label"),buttons:[{text:this.translateService.instant("app.shelly-home.home.device.label"),icon:"add",handler:function(){setTimeout((function(){e.reorder=!0,e.detectChanges()}),1e3),e.createConnected(),e.popoverService.presentModal(b.a,!0,{connectedTo:e.connectedTo},"devices").then((function(){e.reorder=!1}))}},{text:this.translateService.instant("app.shelly-home.home.room.label"),icon:"add",handler:function(){setTimeout((function(){e.reorder=!0,e.detectChanges()}),1e3),e.createConnected(),e.popoverService.presentModal(u.a,!0,{connectedTo:e.connectedTo},"rooms").then((function(){e.reorder=!1}))}},{text:this.translateService.instant("app.shelly-home.home.group.label"),icon:"add",handler:function(){setTimeout((function(){e.reorder=!0,e.detectChanges()}),1e3),e.createConnected(),e.popoverService.presentModal(v.a,!0,{connectedTo:e.connectedTo},"groups").then((function(){e.reorder=!1}))}},{text:this.translateService.instant("app.shelly-home.home.cancel.label"),role:"cancel",icon:"close",handler:function(){console.log("Cancel clicked")}}]})];case 1:return[4,t.sent().present()];case 2:return t.sent(),[2]}}))}))},e.prototype.createConnected=function(){var e=Array.apply(null,{length:this.rows*this.cols}).map((function(e,t){return"dash"+t}));e.push("groups"),e.push("rooms"),e.push("devices"),e.push("trash"),this.connectedTo=e,this.detectChanges()},e.prototype.detectChanges=function(){this.cdr.markForCheck()},e.\u0275fac=function(t){return new(t||e)(k.Nb(C.a),k.Nb(k.D),k.Nb(s.a),k.Nb(f.a),k.Nb(c.e),k.Nb(r.h),k.Nb(k.h))},e.\u0275cmp=k.Hb({type:e,selectors:[["app-dashboard"]],decls:8,vars:5,consts:[[3,"label","reorder","reorderChange","cellsChange"],["id","content","cdkDropListGroup","",1,"boundary",3,"resize"],[2,"margin-bottom","60px"],["size","12"],["size","12","size-xs","12","size-sm","6","size-md","6","size-lg","4","size-xl","3",3,"z-index",4,"ngFor","ngForOf"],["vertical","top","horizontal","center","slot","fixed","edge","",2,"transform","scale(0.6)"],[3,"disabled","click"],["name","add"],["size","12","size-xs","12","size-sm","6","size-md","6","size-lg","4","size-xl","3"],["size","12","cdkDropList","",3,"id","z-index","border","cdkDropListConnectedTo","cdkDropListEnterPredicate","cdkDropListDropped",4,"ngFor","ngForOf"],["size","12","cdkDropList","",3,"id","cdkDropListConnectedTo","cdkDropListEnterPredicate","cdkDropListDropped"],[4,"ngIf"],[4,"ngFor","ngForOf"],["class","dropCard","cdkDrag","",3,"cdkDragData","dashboardRemove","cdkDragDisabled","showRemove","group","reorder","active","show","showChange","onRemove",4,"ngIf"],["class","dropCard","cdkDrag","",3,"dashboardRemove","cdkDragData","cdkDragDisabled","showRemove","room","reorder","active","show","showChange","onRemove",4,"ngIf"],["class","dropCard","style","margin-top: 10px","cdkDrag","","style","position: relative",3,"cdkDragData","cdkDragDisabled",4,"ngIf"],["cdkDrag","",1,"dropCard",3,"cdkDragData","dashboardRemove","cdkDragDisabled","showRemove","group","reorder","active","show","showChange","onRemove"],["class","dragHandle","name","move","slot","end","cdkDragHandle","",4,"ngIf"],["name","move","slot","end","cdkDragHandle","",1,"dragHandle"],["cdkDrag","",1,"dropCard",3,"dashboardRemove","cdkDragData","cdkDragDisabled","showRemove","room","reorder","active","show","showChange","onRemove"],["cdkDrag","",1,"dropCard",2,"position","relative",3,"cdkDragData","cdkDragDisabled"],["mode","md",1,"app-card"],[2,"margin-bottom","-1px",3,"tap"],["sliding",""],[3,"device","deviceStatus","deviceCon","showEdit","showRemove","reorder","sliding","ping",4,"ngIf"],["color","danger",1,"remove",3,"click"],["name","close","slot","end",1,"remove-icon"],[3,"device","deviceStatus","deviceCon","showEdit","showRemove","reorder","sliding","ping"],["class","dragHandle","name","move","slot","end","cdkDragHandle","","style","z-index: 1; margin-left: -30px; background-color: white; opacity: 1; color: #b3b3b3;",4,"ngIf"],["name","move","slot","end","cdkDragHandle","",1,"dragHandle",2,"z-index","1","margin-left","-30px","background-color","white","opacity","1","color","#b3b3b3"]],template:function(e,t){1&e&&(k.Sb(0,"app-header",0),k.ac("reorderChange",(function(e){return t.reorder=e}))("cellsChange",(function(){return t.calcColsAndRows()})),k.Rb(),k.Sb(1,"ion-content",1),k.ac("resize",(function(){return t.calcColsAndRows()}),!1,k.pc),k.Sb(2,"ion-grid",2),k.Sb(3,"ion-row",3),k.wc(4,j,2,4,"ion-col",4),k.Rb(),k.Rb(),k.Sb(5,"ion-fab",5),k.Sb(6,"ion-fab-button",6),k.ac("click",(function(){return t.onClickAdd()})),k.Ob(7,"ion-icon",7),k.Rb(),k.Rb(),k.Rb()),2&e&&(k.ic("label","app.shelly-home.dashboard.label")("reorder",t.reorder),k.Ab(4),k.ic("ngForOf",k.kc(4,N).constructor(t.cols)),k.Ab(2),k.ic("disabled",t.reorder))},directives:[w.a,s.t,p.f,s.z,s.fb,i.s,s.v,s.w,s.B,s.s,p.e,i.t,x.a,p.a,p.b,y.a,s.l,s.L,D.a],styles:["ion-reorder[_ngcontent-%COMP%]{margin-left:10px}  .md .smallFab{margin:5px;margin-right:0!important;height:30px;width:30px;opacity:.7}  .md .smallFab ion-icon{transform:scale(.8)}  .ios .smallFab{margin:5px;margin-right:8px!important;height:30px;width:30px;opacity:.7}  .ios .smallFab ion-icon{transform:scale(.8)}  .ios .dropCard,   .md .dropCard{margin-top:10px}[_nghost-%COMP%]   .dropCard[_ngcontent-%COMP%]{width:100%}.md   [_nghost-%COMP%]   ion-col[_ngcontent-%COMP%]{padding:0}.md   [_nghost-%COMP%]   ion-col[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{height:48px}.ios   [_nghost-%COMP%]   ion-col[_ngcontent-%COMP%]{padding:0}.ios   [_nghost-%COMP%]   ion-col[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{height:48px}.centerCol[_ngcontent-%COMP%]{left:50%;transform:translateX(-50%)}.reorderCard[_ngcontent-%COMP%]{margin-bottom:30px}  .ios .dragHandle{display:block;font-size:34px;opacity:.4;margin:7.5px 6px 7.5px 10px}  .md .dragHandle{display:block;font-size:31px;opacity:.3;margin-left:10px;margin-top:7.5px;margin-bottom:7.5px}  .cdk-drag-placeholder{opacity:.5;pointer-events:none;width:100%}  .cdk-drag-preview ion-card{opacity:.7;box-shadow:0 10px 36px 0 rgba(0,0,0,.75)}  .cdk-drag-preview .loadingCard{opacity:0}.delete[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{border:1px solid red}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.remove[_ngcontent-%COMP%]{right:-18px;top:-14px;border-radius:15px;transform:scale(.4)}.remove[_ngcontent-%COMP%], .remove-icon[_ngcontent-%COMP%]{position:absolute;z-index:2}.remove-icon[_ngcontent-%COMP%]{right:2px;top:6px;color:#fff;pointer-events:none}ion-card[_ngcontent-%COMP%]{overflow:visible}"],changeDetection:0}),e}(),H=function(){function e(){}return e.\u0275mod=k.Lb({type:e}),e.\u0275inj=k.Kb({factory:function(t){return new(t||e)},imports:[[s.Ab,i.c,n.e,c.c,d.a,a.a,p.g,r.j.forChild([{path:"",component:F}])]]}),e}()}}]);