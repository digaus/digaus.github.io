"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1366],{1366:(Kn,Me,p)=>{p.r(Me),p.d(Me,{DashboardPageModule:()=>Xn});var j=p(1391),de=p(6535),b=p(177),C=p(9417),u=p(8974),M=p(3955),nt=p(8834),ot=p(2765),rt=p(5084),ue=p(2102),st=p(9213),we=p(9631),at=p(9183),pe=p(7250),e=(p(6860),p(4438)),_e=p(6600),me=p(1413);let ft=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[_e.yE,_e.pZ]}),s})();var bt=p(1574);let Pe=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[b.MD]}),s})(),yt=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[u.bv,Pe,C.YN,C.X1,b.MD,M.h,j.ad,st.m_,nt.Hl,ue.RG,ot.g7,we.fS,ft,rt.X6,at.D6,pe.Ve,j.ad,de.E9,bt.FR]}),s})();var Ee=p(9793),_=p(467),kt=p(8941),R=p(8254),It=p(6262),$e=p(7376),q=p(4412),D=p(6354),he=p(8141),St=p(6496),J=p(6006),ve=p(605),Ae=p(4843),ge=p(2901),L=p(9195),w=p(7566),oe=p(5071),K=p(6510),ee=p(9553),re=p(9458),se=p(7790),Ve=p(8487);function xt(o,s){1&o&&e.nrm(0,"ion-icon",12)}function Ct(o,s){1&o&&e.nrm(0,"ion-icon",13)}function Tt(o,s){if(1&o){const r=e.RV6();e.j41(0,"ion-button",2),e.bIt("click",function(){const i=e.eBV(r).ngIf,n=e.XpG();return e.Njj(i.loading?n.cancel():n.search())}),e.DNE(1,xt,1,0,"ion-icon",10)(2,Ct,1,0,"ion-icon",11),e.k0s()}if(2&o){const r=s.ngIf;e.R7$(),e.Y8G("ngIf",r.loading),e.R7$(),e.Y8G("ngIf",!r.loading)}}function Mt(o,s){if(1&o){const r=e.RV6();e.qex(0),e.j41(1,"ion-card",17)(2,"app-device",18,0),e.nI1(5,"async"),e.bIt("click",function(i){const n=e.eBV(r).ngIf,a=e.sdS(4),l=e.XpG(3);return e.Njj(l.onClickDevice(i,n,a))}),e.k0s()(),e.bVm()}if(2&o){const r=s.ngIf,t=e.sdS(3);e.R7$(2),e.Y8G("inView","#searchContainer")("ping",e.bMT(5,5,t.isInView))("deviceInfo",r)("showDetails",!1)("reorder",!1)}}function wt(o,s){if(1&o&&(e.qex(0),e.DNE(1,Mt,6,7,"ng-container",9),e.nI1(2,"deviceInfo"),e.nI1(3,"async"),e.bVm()),2&o){const r=s.$implicit;e.R7$(),e.Y8G("ngIf",e.bMT(3,3,e.bMT(2,1,r)))}}function Rt(o,s){1&o&&(e.j41(0,"p",4),e.EFF(1,"No devices found"),e.k0s())}function Dt(o,s){if(1&o&&(e.qex(0),e.j41(1,"ion-list"),e.DNE(2,wt,4,5,"ng-container",14),e.k0s(),e.j41(3,"div",15),e.DNE(4,Rt,2,0,"p",16),e.k0s(),e.bVm()),2&o){const r=s.ngIf;e.R7$(2),e.Y8G("ngForOf",r),e.R7$(2),e.Y8G("ngIf",!(null!=r&&r.length))}}let Fe=(()=>{var o;class s{constructor(t,i,n,a){this.alertService=t,this.modalController=i,this.deviceInfoService=n,this.notificationsService=a,this.status$=new q.t({loading:!1})}ngOnInit(){var t=this;return(0,_.A)(function*(){t.devices$=t.deviceInfoService.subDeviceInfos().pipe((0,ge.o)((i,n)=>(0,ve.Y)(0===n?1:0)),(0,D.T)(i=>i.filter(n=>!n.device.room_id&&!n.device.id.includes("_")&&!!n.ble&&"local"!==n.deviceConStatus).map(n=>n.device.id)))})()}addToWifi(t){var i=this;return(0,_.A)(function*(){var n,a,l,c;const d=yield J.M.getSSID().then(h=>h.ssid).catch(()=>""),m=(null==t||null===(n=t.device)||void 0===n?void 0:n.name)||(null===(a=L.o[null==t||null===(l=t.device)||void 0===l?void 0:l.type])||void 0===a?void 0:a.name)+"-"+(null==t||null===(c=t.device)||void 0===c||null===(c=c.id)||void 0===c?void 0:c.toUpperCase()),v=yield i.alertService.onFoundConnectedDevice(m,d);v&&(i.notificationsService.presentLoading("Sending information to "+m,null),(yield i.deviceInfoService.setWifi(t.device,v.ssid,v.password,t.ble).toPromise().catch(()=>null).then(g=>!!g))&&i.notificationsService.presentCustomToast("app.device-info-service.added-network.label",7e3),i.notificationsService.dismissLoading())})()}onClickDevice(t,i,n){var a=this;return(0,_.A)(function*(){"locked"!==i.deviceConStatus?(i.deviceStatus||(n.unknown?(yield n.stateUnknown(),i=yield(0,Ae._)(a.deviceInfoService.subDeviceInfoChange(i.device.id))):a.addToWifi(i)),i.deviceStatus&&a.addToWifi(i)):n.onClickUnlock(t)})()}search(t){var i=this;return(0,_.A)(function*(){i.status$.next({loading:!0}),t&&(i.event=t),yield i.deviceInfoService.bluetoothWatch(),yield(0,w.wR)(600),i.event&&(i.event.detail.complete(),i.event=null),i.status$.next({loading:!1})})()}cancel(){this.event&&(this.event.detail.complete(),this.event=null),this.status$.next({loading:!1})}closeModal(){var t=this;return(0,_.A)(function*(){yield t.modalController.dismiss()})()}compareKeys(t,i){return JSON.stringify(t)===JSON.stringify(i)}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(oe.u),e.rXU(u.W3),e.rXU(K.E),e.rXU(ee.I))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-bluetooth"]],decls:16,vars:9,consts:[["inView","inView","deviceComp",""],["slot","start"],["color","primary",3,"click"],["slot","icon-only","name","close"],["color","primary"],["slot","end"],["color","primary",3,"click",4,"ngIf"],["id","searchContainer","scroll-events",""],["slot","fixed",3,"ionRefresh"],[4,"ngIf"],["slot","icon-only","name","stop-outline",4,"ngIf"],["slot","icon-only","name","reload-outline",4,"ngIf"],["slot","icon-only","name","stop-outline"],["slot","icon-only","name","reload-outline"],[4,"ngFor","ngForOf"],[1,"searchText"],["color","primary",4,"ngIf"],[1,"dummyCard"],[3,"click","inView","ping","deviceInfo","showDetails","reorder"]],template:function(t,i){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-button",2),e.bIt("click",function(){return i.closeModal()}),e.nrm(4,"ion-icon",3),e.k0s()(),e.j41(5,"ion-title",4),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.j41(8,"ion-buttons",5),e.DNE(9,Tt,3,2,"ion-button",6),e.nI1(10,"async"),e.k0s()()(),e.j41(11,"ion-content",7)(12,"ion-refresher",8),e.bIt("ionRefresh",function(a){return i.search(a)}),e.nrm(13,"ion-refresher-content"),e.k0s(),e.DNE(14,Dt,5,2,"ng-container",9),e.nI1(15,"async"),e.k0s()),2&t&&(e.R7$(6),e.SpI(" ",e.bMT(7,3,"app.component.dashboard.add-device-ble.header.label")," "),e.R7$(3),e.Y8G("ngIf",e.bMT(10,5,i.status$)),e.R7$(5),e.Y8G("ngIf",e.bMT(15,7,i.devices$)))},dependencies:[u.Jm,u.QW,u.b_,u.W9,u.eU,u.iq,u.nf,u.To,u.Ki,u.BC,u.ai,b.Sq,b.bT,re.q,se.q,Ve.n,b.Jj,M.D9],styles:[".header-background{-webkit-backdrop-filter:none!important;backdrop-filter:none!important}.searchText[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;text-align:center;transform:translate(-50%,-50%);white-space:nowrap}.searchText[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{padding-bottom:10px}ion-list[_ngcontent-%COMP%]{display:flex;flex-direction:column}ion-content[_ngcontent-%COMP%]{--padding-bottom: var(--ion-safe-area-bottom)}.dummyCard[_ngcontent-%COMP%]{box-shadow:none!important;padding:0;margin:0;display:block;position:relative;font-family:var(--ion-font-family, inherit);overflow:hidden;border-radius:0!important}"],changeDetection:0}),s})();var Oe=p(3294),Pt=p(152),fe=p(715),te=p(7356);const Et=(o,s)=>({graphSettings:o,loadSettings:s});function $t(o,s){if(1&o&&(e.j41(0,"ion-item",12),e.nrm(1,"app-device",13,0),e.nI1(3,"async"),e.k0s()),2&o){const r=e.sdS(2),t=e.XpG().$implicit,i=e.XpG().ngIf,n=e.XpG();e.R7$(),e.Y8G("inView","#customizeContainer")("ping",e.bMT(3,7,r.isInView))("deviceInfo",i)("config",t.config)("dashboardSettings",e.l_i(9,Et,n.graphSettings,n.loadSettings))("reorder",!1)("showDetails",!1)}}function At(o,s){if(1&o){const r=e.RV6();e.j41(0,"ion-card",10),e.bIt("click",function(){const i=e.eBV(r).index,n=e.XpG(2);return e.Njj(n.selectedLayout=i)}),e.DNE(1,$t,4,12,"ion-item",11),e.k0s()}if(2&o){const r=s.$implicit,t=s.index,i=e.XpG(2);e.xc7("display",r.hidden?"none":null),e.AVh("selected",i.selectedLayout===t||0===t&&!i.selectedLayout),e.R7$(),e.Y8G("ngIf",!r.hidden)}}function Vt(o,s){if(1&o&&(e.j41(0,"ion-list"),e.DNE(1,At,2,5,"ion-card",9),e.nI1(2,"async"),e.k0s()),2&o){const r=e.XpG();e.R7$(),e.Y8G("ngForOf",e.bMT(2,1,r.layouts$))}}let Ft=(()=>{var o;class s{constructor(t,i){this.deviceInfoService=t,this.modalController=i,this.DEVICE_TYPES=L.o}ngOnInit(){this.deviceInfo$=this.deviceInfoService.subDeviceInfoChange(this.deviceId).pipe((0,ge.o)((t,i)=>(0,ve.Y)(0===i?150:0))),this.layouts$=this.deviceInfo$.pipe((0,D.T)(t=>{var i;return t.deviceStatus?((0,fe.Wk)(null==t||null===(i=t.device)||void 0===i?void 0:i.category)||(0,fe.Wk)("default")).map(a=>({config:a,hidden:!(0,fe.p0)(a,t)})):[]}),(0,Oe.F)(this.compareConfig),(0,Pt.B)(100))}closeModal(){var t=this;return(0,_.A)(function*(){yield t.modalController.dismiss()})()}save(){var t=this;return(0,_.A)(function*(){yield t.modalController.dismiss({selectedLayout:t.selectedLayout})})()}addRow(){var t=this;return(0,_.A)(function*(){const i=yield t.modalController.create({component:s,cssClass:"dashboardModal",componentProps:{deviceId:t.deviceId}});yield i.present(),yield i.onWillDismiss()})()}compareConfig(t,i){return JSON.stringify(t)===JSON.stringify(i)}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(K.E),e.rXU(u.W3))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-customize"]],decls:14,vars:6,consts:[["inView","inView"],["slot","start"],["color","primary",3,"click"],["slot","icon-only","name","close"],["color","primary"],["slot","end"],["slot","icon-only","name","checkmark-done-sharp"],["id","customizeContainer","scroll-events","",1,"cards"],[4,"ngIf"],["class","card",3,"selected","display","click",4,"ngFor","ngForOf"],[1,"card",3,"click"],["mode","md","lines","none","button","",4,"ngIf"],["mode","md","lines","none","button",""],[3,"inView","ping","deviceInfo","config","dashboardSettings","reorder","showDetails"]],template:function(t,i){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-button",2),e.bIt("click",function(){return i.closeModal()}),e.nrm(4,"ion-icon",3),e.k0s()(),e.j41(5,"ion-title",4),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.j41(8,"ion-buttons",5)(9,"ion-button",2),e.bIt("click",function(){return i.save()}),e.nrm(10,"ion-icon",6),e.k0s()()()(),e.j41(11,"ion-content",7),e.DNE(12,Vt,3,3,"ion-list",8),e.nI1(13,"async"),e.k0s()),2&t&&(e.R7$(6),e.SpI(" ",e.bMT(7,2,"app.component.customize.header.label")," "),e.R7$(6),e.Y8G("ngIf",e.bMT(13,4,i.deviceInfo$)))},dependencies:[u.Jm,u.QW,u.b_,u.W9,u.eU,u.iq,u.uz,u.nf,u.BC,u.ai,b.Sq,b.bT,re.q,se.q,te.Z,b.Jj,M.D9],styles:["[_nghost-%COMP%]     app-device>div>div>ion-item{--border-color: transparent;pointer-events:none;opacity:1}[_nghost-%COMP%]     app-device>div>div>ion-item *:not(.infoButton), [_nghost-%COMP%]     app-device>div>div>ion-item ion-range::part(bar), [_nghost-%COMP%]     app-device>div>div>ion-item ion-range::part(knob), [_nghost-%COMP%]     app-device>div>div>ion-item ion-range::part(bar-active){pointer-events:none!important}[_nghost-%COMP%]     app-device>div>div>ion-item.item-disabled>ion-grid{opacity:.7}[_nghost-%COMP%]     app-device>div>div>ion-item:not(.item-disabled)>ion-grid{opacity:.7}app-device[_ngcontent-%COMP%]{width:100%;z-index:-1}ion-card.selected[_ngcontent-%COMP%]{box-shadow:0 0 1px 3px var(--ion-color-primary-shade)!important}ion-card[_ngcontent-%COMP%]{transform:translateZ(0)}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0}"],changeDetection:0}),s})();var U=p(9969),je=p(5964),Ue=p(6697),Be=p(2087),A=p(200),Ge=p(9344),X=p(568);const Ot=["matSelect"];function jt(o,s){1&o&&e.nrm(0,"ion-progress-bar",21)}function Ut(o,s){if(1&o&&(e.j41(0,"mat-option",22)(1,"div"),e.EFF(2),e.k0s(),e.j41(3,"div",23),e.EFF(4),e.k0s()()),2&o){const r=s.$implicit,t=e.XpG(2);e.Y8G("value",r),e.R7$(2),e.JRh("Shelly "+t.deviceTypes[r].friendly_name),e.R7$(2),e.SpI(" ",t.deviceTypes[r].name," ")}}function Bt(o,s){if(1&o){const r=e.RV6();e.j41(0,"img",24),e.bIt("error",function(){e.eBV(r);const i=e.XpG(2);return e.Njj(i.onImageError(!0))}),e.k0s()}if(2&o){const r=e.XpG().ngIf;e.Y8G("src","https://home.shelly.cloud/images/device_images/"+r.selectedDevice+".png",e.B4B)}}function Gt(o,s){1&o&&(e.j41(0,"h2",25),e.EFF(1," No image available "),e.k0s())}function Nt(o,s){1&o&&e.nrm(0,"ion-spinner")}function Lt(o,s){1&o&&e.nrm(0,"ion-icon",30)}function Xt(o,s){1&o&&e.nrm(0,"ion-icon",31)}function zt(o,s){1&o&&e.nrm(0,"ion-icon",32)}function Yt(o,s){1&o&&e.nrm(0,"ion-spinner")}function Wt(o,s){1&o&&e.nrm(0,"ion-icon",30)}function Ht(o,s){1&o&&e.nrm(0,"ion-icon",31)}function Jt(o,s){1&o&&e.nrm(0,"ion-spinner")}function Kt(o,s){1&o&&e.nrm(0,"ion-icon",30)}function Qt(o,s){1&o&&e.nrm(0,"ion-icon",31)}function Zt(o,s){1&o&&e.nrm(0,"ion-spinner")}function qt(o,s){1&o&&e.nrm(0,"ion-icon",30)}function ei(o,s){1&o&&e.nrm(0,"ion-icon",31)}function ti(o,s){if(1&o){const r=e.RV6();e.j41(0,"div",26),e.bIt("click",function(){e.eBV(r);const i=e.XpG(2);return e.Njj(i.resetState())}),e.j41(1,"div")(2,"div"),e.EFF(3),e.DNE(4,Nt,1,0,"ion-spinner",1)(5,Lt,1,0,"ion-icon",27)(6,Xt,1,0,"ion-icon",28)(7,zt,1,0,"ion-icon",29),e.k0s(),e.j41(8,"div"),e.EFF(9),e.DNE(10,Yt,1,0,"ion-spinner",1)(11,Wt,1,0,"ion-icon",27)(12,Ht,1,0,"ion-icon",28),e.k0s(),e.j41(13,"div"),e.EFF(14),e.DNE(15,Jt,1,0,"ion-spinner",1)(16,Kt,1,0,"ion-icon",27)(17,Qt,1,0,"ion-icon",28),e.k0s(),e.j41(18,"div"),e.EFF(19),e.DNE(20,Zt,1,0,"ion-spinner",1)(21,qt,1,0,"ion-icon",27)(22,ei,1,0,"ion-icon",28),e.k0s()()()}if(2&o){const r=e.XpG().ngIf,t=e.XpG();e.Y8G("@showHide",void 0),e.R7$(3),e.SpI(' 1. Verifying "',r.network,'" '),e.R7$(),e.Y8G("ngIf",void 0===r.state.verifiedNetwork),e.R7$(),e.Y8G("ngIf",!1===r.state.verifiedNetwork),e.R7$(),e.Y8G("ngIf",!0===r.state.verifiedNetwork&&!r.state.warningNetwork),e.R7$(),e.Y8G("ngIf",!0===r.state.verifiedNetwork&&r.state.warningNetwork),e.R7$(),e.AVh("inactive",!r.state.verifiedNetwork),e.R7$(),e.SpI(' 2. Connecting to "',"Shelly "+t.deviceTypes[r.selectedDevice].friendly_name,'" '),e.R7$(),e.Y8G("ngIf",r.state.verifiedNetwork&&void 0===r.state.connectedShelly),e.R7$(),e.Y8G("ngIf",!1===r.state.connectedShelly),e.R7$(),e.Y8G("ngIf",!0===r.state.connectedShelly),e.R7$(),e.AVh("inactive",!r.state.connectedShelly),e.R7$(),e.SpI(' 3. Sending information to "',"Shelly "+t.deviceTypes[r.selectedDevice].friendly_name,'" '),e.R7$(),e.Y8G("ngIf",r.state.connectedShelly&&void 0===r.state.sendShelly),e.R7$(),e.Y8G("ngIf",!1===r.state.sendShelly),e.R7$(),e.Y8G("ngIf",!0===r.state.sendShelly),e.R7$(),e.AVh("inactive",!r.state.sendShelly),e.R7$(),e.SpI(' 4. Connecting to "',r.network,'" '),e.R7$(),e.Y8G("ngIf",r.state.sendShelly&&void 0===r.state.connectedNetwork),e.R7$(),e.Y8G("ngIf",!1===r.state.connectedNetwork),e.R7$(),e.Y8G("ngIf",!0===r.state.connectedNetwork)}}function ii(o,s){if(1&o){const r=e.RV6();e.qex(0),e.j41(1,"ion-header")(2,"ion-toolbar")(3,"ion-buttons",2)(4,"ion-button",3),e.bIt("click",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.closeModal())}),e.nrm(5,"ion-icon",4),e.k0s()(),e.j41(6,"ion-title",5),e.EFF(7),e.nI1(8,"translate"),e.k0s()(),e.DNE(9,jt,1,0,"ion-progress-bar",6),e.k0s(),e.j41(10,"ion-content",7)(11,"h2"),e.EFF(12),e.nI1(13,"translate"),e.k0s(),e.j41(14,"mat-form-field",8)(15,"mat-label"),e.EFF(16),e.nI1(17,"translate"),e.j41(18,"div",9),e.EFF(19),e.nI1(20,"translate"),e.k0s()(),e.j41(21,"mat-select",10,0),e.mxI("ngModelChange",function(i){const n=e.eBV(r).ngIf;return e.DH7(n.selectedDevice,i)||(n.selectedDevice=i),e.Njj(i)}),e.bIt("ngModelChange",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.onImageError(!1))}),e.j41(23,"mat-select-trigger")(24,"div",11)(25,"div"),e.EFF(26),e.k0s(),e.j41(27,"div"),e.EFF(28),e.k0s()()(),e.DNE(29,Ut,5,3,"mat-option",12),e.k0s()(),e.DNE(30,Bt,1,1,"img",13)(31,Gt,2,0,"h2",14),e.j41(32,"h2"),e.EFF(33),e.nI1(34,"translate"),e.k0s(),e.j41(35,"mat-form-field",15)(36,"mat-label"),e.EFF(37),e.nI1(38,"translate"),e.k0s(),e.j41(39,"input",16),e.mxI("ngModelChange",function(i){const n=e.eBV(r).ngIf;return e.DH7(n.network,i)||(n.network=i),e.Njj(i)}),e.k0s()(),e.j41(40,"mat-form-field",17)(41,"mat-label"),e.EFF(42),e.nI1(43,"translate"),e.k0s(),e.j41(44,"input",18),e.mxI("ngModelChange",function(i){const n=e.eBV(r).ngIf;return e.DH7(n.password,i)||(n.password=i),e.Njj(i)}),e.k0s()()(),e.j41(45,"ion-footer")(46,"ion-toolbar")(47,"ion-button",19),e.bIt("click",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.addDevice())}),e.EFF(48),e.nI1(49,"translate"),e.k0s()()(),e.DNE(50,ti,23,24,"div",20),e.bVm()}if(2&o){const r=s.ngIf,t=e.XpG();e.R7$(7),e.SpI(" ",e.bMT(8,22,"app.component.more.add-devices.label")," "),e.R7$(2),e.Y8G("ngIf",r.loading),e.R7$(3),e.JRh(e.bMT(13,24,"app.component.add.select-shelly.label")),e.R7$(4),e.SpI(" ",e.bMT(17,26,"app.component.add.select-type.label")," "),e.R7$(3),e.SpI(" ",e.bMT(20,28,"app.component.add.select-ssid.label")," "),e.R7$(2),e.R50("ngModel",r.selectedDevice),e.Y8G("disabled",r.loading),e.R7$(5),e.SpI(" ","Shelly "+t.deviceTypes[r.selectedDevice].friendly_name," "),e.R7$(2),e.SpI(" ",t.deviceTypes[r.selectedDevice].name," "),e.R7$(),e.Y8G("ngForOf",r.devices),e.R7$(),e.Y8G("ngIf",!r.imageError),e.R7$(),e.Y8G("ngIf",r.imageError),e.R7$(2),e.JRh(e.bMT(34,30,"app.component.add.network.header.label")),e.R7$(4),e.JRh(e.bMT(38,32,"app.component.add.network.label")),e.R7$(2),e.R50("ngModel",r.network),e.Y8G("disabled",r.loading),e.R7$(3),e.JRh(e.bMT(43,34,"app.component.add.password.label")),e.R7$(2),e.R50("ngModel",r.password),e.Y8G("disabled",r.loading),e.R7$(3),e.Y8G("disabled",!r.network||!r.password||r.loading),e.R7$(),e.SpI(" ",e.bMT(49,36,"app.component.add.confirm.label")," "),e.R7$(2),e.Y8G("ngIf",r.state)}}let Ne=(()=>{var o;class s{constructor(t,i,n,a,l,c){this.localService=t,this.alertService=i,this.lookupService=n,this.modalController=a,this.deviceInfoService=l,this.notificationsService=c,this.state$=new q.t({devices:[],selectedDevice:"SHSW-1"}),this.slideOpts={initialSlide:0,speed:400},this.deviceTypes=L.o,this.ignoredDevices=["PLG1NB","SMK1NB","DS1NB","MS1NB","HT1NB","WS1NB","SHSW-1S","SHUNI-1","SHSPOT-1","undefined"]}ngOnInit(){var t=this;return(0,_.A)(function*(){t.state$.value.devices=Object.keys(L.o).filter(i=>-1===t.ignoredDevices.indexOf(i)).filter((i,n,a)=>a.findIndex(c=>t.deviceTypes[i].name===t.deviceTypes[c].name)===n).sort(),t.state$.value.network=yield J.M.getSSID().then(i=>i.ssid).catch(()=>""),t.state$.next(t.state$.value)})()}ngAfterViewInit(){setTimeout(()=>this.matSelect.focus(),550)}ngOnDestroy(){}onImageError(t){this.state$.value.imageError=t,this.state$.next(this.state$.value)}closeModal(){var t=this;return(0,_.A)(function*(){yield t.modalController.dismiss()})()}resetState(){(Object.keys(this.state$.value.state).some(i=>!1===this.state$.value.state[i])||this.state$.value.state.connectedNetwork)&&(this.state$.value.state=void 0,this.state$.next(this.state$.value))}addDevice(){var t=this;return(0,_.A)(function*(){t.state$.value.loading=!0,t.state$.value.state={},t.state$.next(t.state$.value);const i=yield J.M.getSSID().then(a=>a.ssid).catch(()=>null),n=yield J.M.connect({ssid:t.state$.value.network,password:t.state$.value.password}).then(a=>a.ssid).catch(()=>null);if(t.state$.value.state={warningNetwork:i===t.state$.value.network,verifiedNetwork:!!n},t.state$.next(t.state$.value),t.state$.value.state.verifiedNetwork){t.deviceInfoService.foundOpen=!0;const a=yield J.M.connectPrefix({ssid:L.o[t.state$.value.selectedDevice].name+"-"}).then(l=>l.ssid).catch(()=>null);if(t.state$.value.state.connectedShelly=!!a,t.state$.next(t.state$.value),t.state$.value.state.connectedShelly){const l=yield t.deviceInfoService.pingShellyWifi("192.168.33.1").toPromise().catch(()=>null);let c=!1;if(l){const d=yield t.deviceInfoService.subDeviceInfoChange(l).pipe((0,je.p)(v=>!!v&&v.deviceConStatus!==A.z.offline),(0,Ue.s)(1),(0,Be.w)(2e4)).toPromise();(yield t.checkLocked(d))&&(c=yield t.deviceInfoService.setWifi(d.device,t.state$.value.network,t.state$.value.password,"192.168.33.1").toPromise().catch(v=>null).then(v=>!!v))}if(t.state$.value.state.sendShelly=c,t.state$.next(t.state$.value),t.state$.value.state.sendShelly){yield(0,w.wR)(2e3);const d=yield J.M.connect({ssid:t.state$.value.network,password:t.state$.value.password}).then(m=>m.ssid).catch(()=>null);t.state$.value.state.connectedNetwork=!!d,t.state$.next(t.state$.value)}}}t.state$.value.state.connectedNetwork&&t.notificationsService.presentCustomToast("app.device-info-service.added-network.label",7e3),t.deviceInfoService.foundOpen=!1,t.state$.value.loading=!1,t.state$.next(t.state$.value)})()}checkLocked(t){var i=this;return(0,_.A)(function*(){if(t.deviceConStatus===A.z.locked){var n;const a=yield i.alertService.onClickUnlock(null==t||null===(n=t.device)||void 0===n?void 0:n.gen);if(a){const l={enabled:!0,unprotected:!1,password:(0,w.lR)(a.password),username:2!=t.device.gen&&3!=t.device.gen?(0,w.lR)(a.username):"admin"},c=(0,$e.cloneDeep)(t.device);c.login=l;const d=yield i.localService.deviceInfo(c,t.ip||t.ble).toPromise().catch(()=>null);if(d)return c.category=i.deviceInfoService.getCategory(c.type,d.mode),c.template=L.o[c.type].template||NaN+((d?d.mode:null)||L.o[c.type].modes[0]),c.name=c.name||(null==d?void 0:d.name)||void 0,i.lookupService.setDevice(c.id,c),yield i.deviceInfoService.checkStatus(c,t.ip,!0).pipe((0,Ue.s)(1)).toPromise(),!0}return!1}return!0})()}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(Ge.n),e.rXU(oe.u),e.rXU(X.s),e.rXU(u.W3),e.rXU(K.E),e.rXU(ee.I))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-search"]],viewQuery:function(t,i){if(1&t&&e.GBs(Ot,5),2&t){let n;e.mGM(n=e.lsd())&&(i.matSelect=n.first)}},decls:2,vars:3,consts:[["matSelect",""],[4,"ngIf"],["slot","start"],["color","primary",3,"click"],["slot","icon-only","name","close"],["color","primary"],["type","indeterminate",4,"ngIf"],["fullscreen","true","id","searchContainer","scroll-events",""],["appearance","fill",1,"select"],[2,"float","right","padding-right","25px"],[3,"ngModelChange","ngModel","disabled"],[1,"label"],[3,"value",4,"ngFor","ngForOf"],[3,"src","error",4,"ngIf"],["style","height: 184px; vertical-align: center; line-height: 160px;",4,"ngIf"],["appearance","fill",1,"network"],["matInput","","type","ssid",3,"ngModelChange","ngModel","disabled"],["appearance","fill",1,"password"],["matInput","","type","password",3,"ngModelChange","ngModel","disabled"],["expand","block","fill","outline",2,"height","48px","margin","5px",3,"click","disabled"],["class","status addingWifiDevice",3,"click",4,"ngIf"],["type","indeterminate"],[3,"value"],[2,"float","right","filter","contrast(0.5)"],[3,"error","src"],[2,"height","184px","vertical-align","center","line-height","160px"],[1,"status","addingWifiDevice",3,"click"],["slot","icon-only","name","close","color","danger",4,"ngIf"],["slot","icon-only","name","checkmark-done-outline","color","success",4,"ngIf"],["slot","icon-only","name","warning-outline","color","warning",4,"ngIf"],["slot","icon-only","name","close","color","danger"],["slot","icon-only","name","checkmark-done-outline","color","success"],["slot","icon-only","name","warning-outline","color","warning"]],template:function(t,i){1&t&&(e.DNE(0,ii,51,38,"ng-container",1),e.nI1(1,"async")),2&t&&e.Y8G("ngIf",e.bMT(1,1,i.state$))},dependencies:[u.Jm,u.QW,u.W9,u.M0,u.eU,u.iq,u.FH,u.w2,u.BC,u.ai,C.me,C.BC,C.vS,b.Sq,b.bT,ue.rl,ue.nJ,we.fg,pe.VO,pe.$2,_e.wT,b.Jj,M.D9],styles:[".header-background{-webkit-backdrop-filter:none!important;backdrop-filter:none!important}.select[_ngcontent-%COMP%]{width:100%;max-width:400px;padding:0 50px;margin:0 auto;display:block}.label[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.label[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:first-child{overflow:hidden;text-overflow:ellipsis}.label[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:last-child{filter:contrast(.5)}  body.dark .select mat-label{color:#9fa8da}  body:not(.dark) .select mat-label{color:#3f51b5}.select[_ngcontent-%COMP%]     label{min-width:132%}.select[_ngcontent-%COMP%]     .mat-mdc-select-arrow-wrapper{min-width:20px;justify-content:flex-end}.mat-mdc-option[_ngcontent-%COMP%]     span{width:100%;display:flex;align-items:baseline;justify-content:space-between;font-size:14px}.mat-mdc-option[_ngcontent-%COMP%]     span>div:first-child{text-overflow:ellipsis;white-space:nowrap;overflow:hidden;flex:0 1 auto}.mat-mdc-option[_ngcontent-%COMP%]     mat-pseudo-checkbox{display:none}img[_ngcontent-%COMP%]{padding-top:15px;padding-bottom:15px;margin:0 auto;display:block;height:200px}.network[_ngcontent-%COMP%], .password[_ngcontent-%COMP%]{width:100%;max-width:400px;padding-left:50px;padding-right:50px;margin:0 auto;display:block}h2[_ngcontent-%COMP%]{padding-top:20px;text-align:center}.status[_ngcontent-%COMP%]{position:fixed;width:100vw;height:100vh;background-color:#d3d3d33a;z-index:10}.status[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{color:var(--ion-text-color, #000);background:var(--ion-background-color, #fff);border-radius:10px;padding:10px;height:auto;width:-moz-fit-content;width:fit-content;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%)}.status[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{padding:7px;display:flex;justify-content:space-between;align-items:center;width:max-content;min-width:-webkit-fill-available;max-width:calc(100vw - 30px)}.status[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > ion-spinner[_ngcontent-%COMP%]{height:20px;min-width:20px;margin-left:5px}.status[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > div[_ngcontent-%COMP%] > ion-icon[_ngcontent-%COMP%]{font-size:20px;margin-left:5px;min-width:20px}.status[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   div.inactive[_ngcontent-%COMP%]{color:#a9a9a9;margin-right:40px}"],data:{animation:[(0,U.hZ)("showHide",[(0,U.kY)(":enter",[(0,U.iF)({opacity:"0"}),(0,U.i0)("300ms ease-in",(0,U.iF)({opacity:"1"}))]),(0,U.kY)(":leave",[(0,U.i0)("300ms ease-out",(0,U.iF)({opacity:"0"}))])])]},changeDetection:0}),s})();var ni=p(8948),oi=p(1723),ri=p(7149),Le=p(6644),si=p(4989),ae=p(9316),Xe=p(4572),ze=p(7673),Ye=p(5558),ai=p(3103),be=p(1626),li=p(9437),ci=p(1118),We=p(551),ye=p(5083),P=p(2739);typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"&&global;var ie=function(o){return o.Unimplemented="UNIMPLEMENTED",o.Unavailable="UNAVAILABLE",o}(ie||{});class ke extends Error{constructor(s,r,t){super(s),this.message=s,this.code=r,this.data=t}}const _i=o=>{var s,r,t,i,n;const a=o.CapacitorCustomPlatform||null,l=o.Capacitor||{},c=l.Plugins=l.Plugins||{},d=o.CapacitorPlatforms,v=(null===(s=null==d?void 0:d.currentPlatform)||void 0===s?void 0:s.getPlatform)||(()=>null!==a?a.name:(o=>{var s,r;return null!=o&&o.androidBridge?"android":null!==(r=null===(s=null==o?void 0:o.webkit)||void 0===s?void 0:s.messageHandlers)&&void 0!==r&&r.bridge?"ios":"web"})(o)),g=(null===(r=null==d?void 0:d.currentPlatform)||void 0===r?void 0:r.isNativePlatform)||(()=>"web"!==v()),y=(null===(t=null==d?void 0:d.currentPlatform)||void 0===t?void 0:t.isPluginAvailable)||(k=>{const I=z.get(k);return!!(null!=I&&I.platforms.has(v())||V(k))}),V=(null===(i=null==d?void 0:d.currentPlatform)||void 0===i?void 0:i.getPluginHeader)||(k=>{var I;return null===(I=l.PluginHeaders)||void 0===I?void 0:I.find(Q=>Q.name===k)}),z=new Map,Yn=(null===(n=null==d?void 0:d.currentPlatform)||void 0===n?void 0:n.registerPlugin)||((k,I={})=>{const Q=z.get(k);if(Q)return console.warn(`Capacitor plugin "${k}" already registered. Cannot register plugins twice.`),Q.proxy;const Y=v(),Z=V(k);let O;const Wn=function(){var S=(0,_.A)(function*(){return!O&&Y in I?O=O="function"==typeof I[Y]?yield I[Y]():I[Y]:null!==a&&!O&&"web"in I&&(O=O="function"==typeof I.web?yield I.web():I.web),O});return function(){return S.apply(this,arguments)}}(),Ce=S=>{let x;const $=(...G)=>{const N=Wn().then(E=>{const W=((S,x)=>{var $,G;if(!Z){if(S)return null===(G=S[x])||void 0===G?void 0:G.bind(S);throw new ke(`"${k}" plugin is not implemented on ${Y}`,ie.Unimplemented)}{const N=null==Z?void 0:Z.methods.find(E=>x===E.name);if(N)return"promise"===N.rtype?E=>l.nativePromise(k,x.toString(),E):(E,W)=>l.nativeCallback(k,x.toString(),E,W);if(S)return null===($=S[x])||void 0===$?void 0:$.bind(S)}})(E,S);if(W){const ce=W(...G);return x=null==ce?void 0:ce.remove,ce}throw new ke(`"${k}.${S}()" is not implemented on ${Y}`,ie.Unimplemented)});return"addListener"===S&&(N.remove=(0,_.A)(function*(){return x()})),N};return $.toString=()=>`${S.toString()}() { [capacitor code] }`,Object.defineProperty($,"name",{value:S,writable:!1,configurable:!1}),$},tt=Ce("addListener"),it=Ce("removeListener"),Jn=(S,x)=>{const $=tt({eventName:S},x),G=function(){var E=(0,_.A)(function*(){const W=yield $;it({eventName:S,callbackId:W},x)});return function(){return E.apply(this,arguments)}}(),N=new Promise(E=>$.then(()=>E({remove:G})));return N.remove=(0,_.A)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield G()}),N},Te=new Proxy({},{get(S,x){switch(x){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return Z?Jn:tt;case"removeListener":return it;default:return Ce(x)}}});return c[k]=Te,z.set(k,{name:k,proxy:Te,platforms:new Set([...Object.keys(I),...Z?[Y]:[]])}),Te});return l.convertFileSrc||(l.convertFileSrc=k=>k),l.getPlatform=v,l.handleError=k=>o.console.error(k),l.isNativePlatform=g,l.isPluginAvailable=y,l.pluginMethodNoop=(k,I,Q)=>Promise.reject(`${Q} does not have an implementation of "${I}".`),l.registerPlugin=Yn,l.Exception=ke,l.DEBUG=!!l.DEBUG,l.isLoggingEnabled=!!l.isLoggingEnabled,l.platform=l.getPlatform(),l.isNative=l.isNativePlatform(),l},ne=(o=>o.Capacitor=_i(o))(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Ie=ne.registerPlugin;class Je{constructor(s){this.listeners={},this.windowListeners={},s&&(console.warn(`Capacitor WebPlugin "${s.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=s)}addListener(s,r){var t=this;this.listeners[s]||(this.listeners[s]=[]),this.listeners[s].push(r);const n=this.windowListeners[s];n&&!n.registered&&this.addWindowListener(n);const a=function(){var c=(0,_.A)(function*(){return t.removeListener(s,r)});return function(){return c.apply(this,arguments)}}(),l=Promise.resolve({remove:a});return Object.defineProperty(l,"remove",{value:(c=(0,_.A)(function*(){console.warn("Using addListener() without 'await' is deprecated."),yield a()}),function(){return c.apply(this,arguments)})}),l;var c}removeAllListeners(){var s=this;return(0,_.A)(function*(){s.listeners={};for(const r in s.windowListeners)s.removeWindowListener(s.windowListeners[r]);s.windowListeners={}})()}notifyListeners(s,r){const t=this.listeners[s];t&&t.forEach(i=>i(r))}hasListeners(s){return!!this.listeners[s].length}registerWindowListener(s,r){this.windowListeners[r]={registered:!1,windowEventName:s,pluginEventName:r,handler:t=>{this.notifyListeners(r,t)}}}unimplemented(s="not implemented"){return new ne.Exception(s,ie.Unimplemented)}unavailable(s="not available"){return new ne.Exception(s,ie.Unavailable)}removeListener(s,r){var t=this;return(0,_.A)(function*(){const i=t.listeners[s];if(!i)return;const n=i.indexOf(r);t.listeners[s].splice(n,1),t.listeners[s].length||t.removeWindowListener(t.windowListeners[s])})()}addWindowListener(s){window.addEventListener(s.windowEventName,s.handler),s.registered=!0}removeWindowListener(s){s&&(window.removeEventListener(s.windowEventName,s.handler),s.registered=!1)}}const Ke=o=>encodeURIComponent(o).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Qe=o=>o.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class mi extends Je{getCookies(){return(0,_.A)(function*(){const s=document.cookie,r={};return s.split(";").forEach(t=>{if(t.length<=0)return;let[i,n]=t.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=Qe(i).trim(),n=Qe(n).trim(),r[i]=n}),r})()}setCookie(s){return(0,_.A)(function*(){try{const r=Ke(s.key),t=Ke(s.value),i=`; expires=${(s.expires||"").replace("expires=","")}`,n=(s.path||"/").replace("path=",""),a=null!=s.url&&s.url.length>0?`domain=${s.url}`:"";document.cookie=`${r}=${t||""}${i}; path=${n}; ${a};`}catch(r){return Promise.reject(r)}})()}deleteCookie(s){return(0,_.A)(function*(){try{document.cookie=`${s.key}=; Max-Age=0`}catch(r){return Promise.reject(r)}})()}clearCookies(){return(0,_.A)(function*(){try{const s=document.cookie.split(";")||[];for(const r of s)document.cookie=r.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(s){return Promise.reject(s)}})()}clearAllCookies(){var s=this;return(0,_.A)(function*(){try{yield s.clearCookies()}catch(r){return Promise.reject(r)}})()}}Ie("CapacitorCookies",{web:()=>new mi});const hi=function(){var o=(0,_.A)(function*(s){return new Promise((r,t)=>{const i=new FileReader;i.onload=()=>{const n=i.result;r(n.indexOf(",")>=0?n.split(",")[1]:n)},i.onerror=n=>t(n),i.readAsDataURL(s)})});return function(r){return o.apply(this,arguments)}}();class bi extends Je{request(s){return(0,_.A)(function*(){const r=((o,s={})=>{const r=Object.assign({method:o.method||"GET",headers:o.headers},s),i=((o={})=>{const s=Object.keys(o);return Object.keys(o).map(i=>i.toLocaleLowerCase()).reduce((i,n,a)=>(i[n]=o[s[a]],i),{})})(o.headers)["content-type"]||"";if("string"==typeof o.data)r.body=o.data;else if(i.includes("application/x-www-form-urlencoded")){const n=new URLSearchParams;for(const[a,l]of Object.entries(o.data||{}))n.set(a,l);r.body=n.toString()}else if(i.includes("multipart/form-data")||o.data instanceof FormData){const n=new FormData;if(o.data instanceof FormData)o.data.forEach((l,c)=>{n.append(c,l)});else for(const l of Object.keys(o.data))n.append(l,o.data[l]);r.body=n;const a=new Headers(r.headers);a.delete("content-type"),r.headers=a}else(i.includes("application/json")||"object"==typeof o.data)&&(r.body=JSON.stringify(o.data));return r})(s,s.webFetchExtra),t=((o,s=!0)=>o?Object.entries(o).reduce((t,i)=>{const[n,a]=i;let l,c;return Array.isArray(a)?(c="",a.forEach(d=>{l=s?encodeURIComponent(d):d,c+=`${n}=${l}&`}),c.slice(0,-1)):(l=s?encodeURIComponent(a):a,c=`${n}=${l}`),`${t}&${c}`},"").substr(1):null)(s.params,s.shouldEncodeUrlParams),i=t?`${s.url}?${t}`:s.url,n=yield fetch(i,r),a=n.headers.get("content-type")||"";let c,d,{responseType:l="text"}=n.ok?s:{};switch(a.includes("application/json")&&(l="json"),l){case"arraybuffer":case"blob":d=yield n.blob(),c=yield hi(d);break;case"json":c=yield n.json();break;default:c=yield n.text()}const m={};return n.headers.forEach((v,h)=>{m[h]=v}),{data:c,headers:m,status:n.status,url:n.url}})()}get(s){var r=this;return(0,_.A)(function*(){return r.request(Object.assign(Object.assign({},s),{method:"GET"}))})()}post(s){var r=this;return(0,_.A)(function*(){return r.request(Object.assign(Object.assign({},s),{method:"POST"}))})()}put(s){var r=this;return(0,_.A)(function*(){return r.request(Object.assign(Object.assign({},s),{method:"PUT"}))})()}patch(s){var r=this;return(0,_.A)(function*(){return r.request(Object.assign(Object.assign({},s),{method:"PATCH"}))})()}delete(s){var r=this;return(0,_.A)(function*(){return r.request(Object.assign(Object.assign({},s),{method:"DELETE"}))})()}}Ie("CapacitorHttp",{web:()=>new bi});const yi=Ie("Filesystem",{electron:()=>window.CapacitorCustomPlatform.plugins.Filesystem});var ki=p(7157),Ii=p(345);let B=P.YA,Si=(()=>{var o;class s{constructor(t,i){this.platform=t,this.domSanitizer=i,this.baseDirectory=P.__.Data,this.folder="ShellyHome",this.platform.is("electron")&&(B=yi)}initFolder(t){var i=this;return(0,_.A)(function*(){return i.platform.is("electron")&&(i.baseDirectory=P.__.Documents),i.folder=t,yield B.mkdir({path:i.folder,directory:i.baseDirectory,recursive:!1}).catch(n=>(console.error(n),null)),i.directory=yield B.getUri({path:i.folder,directory:i.baseDirectory}).catch(n=>(console.error(n),null)),i.directory})()}fetchFileNames(t=this.folder){var i=this;return(0,_.A)(function*(){var n;const a=yield B.readdir({path:t,directory:i.baseDirectory}).catch(c=>(console.error(c),null)),l=a?null===(n=a.files)||void 0===n?void 0:n.map(c=>c.name||c):[];return console.log(l),l.length>0?(yield Promise.all(l.map(m=>i.fetchFileNames(t+"/"+m)))).reduce((m,v)=>[...m,...v],[]):[t]})()}writeFile(t,i,n=3/64){var a=this;return(0,_.A)(function*(){if(console.log(t,i),a.platform.is("capacitor")||a.platform.is("electron")){const l=yield a.convertToBase64(i);yield B.writeFile({path:a.folder+"/"+t,directory:a.baseDirectory,data:l,recursive:!0})}else yield B.writeFile({path:a.folder+"/"+t,directory:a.baseDirectory,data:i,encoding:P.Wi.UTF8,recursive:!0})})()}readFile(t){var i=this;return(0,_.A)(function*(){if(i.platform.is("capacitor")||i.platform.is("electron")){const n=ye.Ii.convertFileSrc(i.directory.uri+"/"+t);return{success:i.domSanitizer.bypassSecurityTrustResourceUrl(n),revoke:()=>{}}}{const n=yield i.readFileAsBlob(t),a=URL.createObjectURL(n);return{success:i.domSanitizer.bypassSecurityTrustResourceUrl(a),revoke:()=>{URL.revokeObjectURL(a)}}}})()}readFileAsBlob(t){var i=this;return(0,_.A)(function*(){if(i.platform.is("capacitor")||i.platform.is("electron")){const n=ye.Ii.convertFileSrc(i.directory.uri+"/"+t);return yield fetch(n).then(l=>l.blob())}return(yield B.readFile({path:i.folder+"/"+t,directory:i.baseDirectory})).data})()}deleteFile(t){var i=this;return(0,_.A)(function*(){yield B.deleteFile({path:i.folder+"/"+t,directory:i.baseDirectory}).catch(n=>(console.error(n),null))})()}start(){var t=this;return(0,_.A)(function*(){const i=t.directory.uri;return yield We.q.start({path:i,port:8080}).then(n=>"http://"+n.ip+":8080").catch(n=>null)})()}stop(){return(0,_.A)(function*(){yield We.q.stop().catch(t=>console.log(t))})()}convertToBase64Chunks(t,i,n){var a=this;return(0,_.A)(function*(){const l=1048576*i;if(l%6)throw{error:"Chunksize must be a multiple of 6!"};{const c=t.size;for(;t.size>l;){const m=yield a.convertToBase64(t.slice(0,l));yield n(c===t.size?m:m.split(",")[1],c===t.size),t=t.slice(l)}const d=yield a.convertToBase64(t.slice(0,t.size));yield n(d.split(",")[1],c===t.size),t=t.slice(t.size)}})()}convertToBase64(t){return new Promise((i,n)=>{let a=new FileReader;const l=a._realReader;l&&(a=l),a.onerror=c=>{console.log(c),n()},a.onload=()=>{i(a.result)},a.readAsDataURL(t)})}}return(o=s).\u0275fac=function(t){return new(t||o)(e.KVO(ki.OD),e.KVO(Ii.up))},o.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),s})();var xi=p(6265);let Ze=(()=>{var o;class s{constructor(t,i,n,a,l,c,d){this.http=t,this.httpClient=i,this.fileService=n,this.deviceService=a,this.translateService=l,this.loadingController=c,this.notificationsService=d}checkDevices(t,i,n="update",a){let l={};return{deviceInfos:i.filter(d=>{var m;const v=d.deviceInfos[0],h=null===(m=v.deviceStatus)||void 0===m||null===(m=m.update)||void 0===m?void 0:m.old_version;if(v.deviceStatus&&h){let y=!1;const f=v.device.type;var g,T;return"update"===n?(y=!!t[f]&&(null===(g=t[f].version)||void 0===g?void 0:g.split("/")[0])>(null==h?void 0:h.split("/")[0]),y&&(l[f]={version:t[f].version,url:t[f].url}),y):"beta"===n?(y=!!t[f]&&(null===(T=t[f].beta_ver)||void 0===T?void 0:T.split("/")[0])>(null==h?void 0:h.split("/")[0]),y&&(l[f]={beta_ver:t[f].beta_ver,beta_url:t[f].beta_url}),y):("revert"===n?(y=t[f]&&t[f].version&&((null==h?void 0:h.indexOf("-rc"))>-1||(null==h?void 0:h.indexOf("-beta"))>-1||(null==h?void 0:h.indexOf("-dev"))>-1||(null==h?void 0:h.indexOf("master"))>-1),y&&(l[f]={version:t[f].version,url:t[f].url})):"select"===n&&a&&(y=a.startsWith(f)&&f+"_"+(null==h?void 0:h.split("/")[0])!==(null==a?void 0:a.split(".")[0]),y&&(l[f]={version:a,url:a})),y)}return!1}),firmwareList:l}}checkFirmwares(){var t=this;return(0,_.A)(function*(){yield t.fileService.initFolder("ShellyHome");let i=yield t.deviceService.getFirmwareList();if(!i){i={};const n=yield t.getFirmareEntries();for(const a of n){const l=a.split("/").slice(0,-1).join("/");i[a.split("_")[0]]={url:null,version:l}}}return i})()}startDeviceUpdateServer(){return this.fileService.start()}downloadFiles(t){var i=this;return(0,_.A)(function*(){if(t){const n=yield i.getFirmareEntries(),a=Object.keys(t).filter(l=>-1===n.indexOf(i.getFilename(l,t[l].version||t[l].beta_ver,t[l].url||t[l].beta_url)));if(console.log(a),a.length>0){const l=yield i.loadingController.create({message:i.translateService.instant("app.component.update.download.label")+" (0/"+a.length+")",showBackdrop:!1});yield l.present();const c={},d={};let m=0;yield i.http.setServerTrustMode("nocheck").catch(()=>null);const v=a.map(h=>{const g=t[h].url||t[h].beta_url,y=i.getFilename(h,t[h].version||t[h].beta_ver,g);return(0,Ae._)(i.httpClient.get(g,{responseType:"blob",reportProgress:!0,observe:"events"}).pipe((0,je.p)(f=>{if(f.type===be.hv.DownloadProgress){c[g]=f.total,d[g]=f.loaded;const V=Object.keys(d).map(F=>d[F]).reduce((F,z)=>F+z,0),le=Object.keys(c).map(F=>c[F]).reduce((F,z)=>F+z,0);l.message=(V/1e3).toFixed()+" / "+(le/1e3).toFixed()+" KB ("+(V/le*100).toFixed()+"%)"}return f.type===be.hv.Response}),(0,Ye.n)(function(){var f=(0,_.A)(function*(V){return console.log(y,V.body),yield i.fileService.writeFile(y,V.body),!0});return function(V){return f.apply(this,arguments)}}()),(0,li.W)(()=>(0,ze.of)(!1)),(0,he.M)(()=>{var f;m++,null!==(f=l.message)&&void 0!==f&&f.toString().startsWith(i.translateService.instant("app.component.update.download.label"))&&(l.message=i.translateService.instant("app.component.update.download.label")+" ("+m+"/"+a.length+")")})))});yield Promise.all(v),yield l.dismiss(),yield i.http.setServerTrustMode("default").catch(()=>null)}else i.notificationsService.presentCustomToast("app.component.update.download-done.label")}})()}getFirmareEntries(){var t=this;return(0,_.A)(function*(){const i=yield t.fileService.fetchFileNames();return console.log(i),i.map(n=>n.replace("ShellyHome/",""))})()}getFilename(t,i,n){return t+"/"+i+"/"+n.split("/").pop()}}return(o=s).\u0275fac=function(t){return new(t||o)(e.KVO(ci.B),e.KVO(be.Qq),e.KVO(Si),e.KVO(xi.g),e.KVO(M.c$),e.KVO(u.Xi),e.KVO(ee.I))},o.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),s})();function Ci(o,s){1&o&&e.nrm(0,"ion-progress-bar",9)}let Ti=(()=>{var o;class s{constructor(t,i){this.deviceUpdateService=t,this.modalController=i,this.state$=new me.B}ngOnInit(){var t=this;return(0,_.A)(function*(){(yield t.deviceUpdateService.getFirmareEntries()).map(a=>({type:a.split("/")[0],firmware:a}))})()}dismiss(){this.modalController.dismiss()}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(Ze),e.rXU(u.W3))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-update-firmware"]],decls:19,vars:7,consts:[["slot","start"],["color","primary",3,"click"],["slot","icon-only","name","close"],["color","primary"],["slot","end"],["slot","icon-only","name","upload-outline"],["type","indeterminate",4,"ngIf"],["fullscreen","true","scroll-events",""],["expand","block","fill","outline",2,"height","48px","margin","5px"],["type","indeterminate"]],template:function(t,i){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.bIt("click",function(){return i.dismiss()}),e.nrm(4,"ion-icon",2),e.k0s()(),e.j41(5,"ion-title",3),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.j41(8,"ion-buttons",4)(9,"ion-button",3),e.nrm(10,"ion-icon",5),e.k0s()()(),e.DNE(11,Ci,1,0,"ion-progress-bar",6),e.k0s(),e.j41(12,"ion-content",7),e.nrm(13,"ion-list"),e.k0s(),e.j41(14,"ion-footer")(15,"ion-toolbar")(16,"ion-button",8),e.EFF(17),e.nI1(18,"translate"),e.k0s()()()),2&t&&(e.R7$(6),e.SpI(" ",e.bMT(7,3,"Select firmware")," "),e.R7$(5),e.Y8G("ngIf",!1),e.R7$(6),e.SpI(" ",e.bMT(18,5,"app.component.update.confirm.label")," "))},dependencies:[u.Jm,u.QW,u.W9,u.M0,u.eU,u.iq,u.nf,u.FH,u.BC,u.ai,b.bT,M.D9],styles:[".md.update-settings-popover::part(content){margin-top:-42px;width:max-content;height:max-content}  .ios.update-settings-popover::part(content){width:max-content;height:max-content}.currentIp[_ngcontent-%COMP%]{font-size:12px;width:100%;height:12px;text-align:center;padding-top:7px;position:absolute;z-index:2}.addButton[_ngcontent-%COMP%]{--border-radius: 20px !important;height:35px;width:35px}.mat-form-field[_ngcontent-%COMP%]{font-size:6px;padding-top:1.7em}.mat-form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-size:15px}"],changeDetection:0}),s})(),Mi=(()=>{var o;class s{constructor(t){this.popoverController=t,this.type="update"}confirm(){this.popoverController.dismiss({type:this.type})}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(u.IE))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-update-settings"]],decls:13,vars:6,consts:[["mode","md","button","","lines","none",3,"click","detail"],["slot","start",2,"pointer-events","none","margin-left","5px","margin-right","20px",3,"ngModel"],["color","primary",2,"text-align","center","padding-right","25px"]],template:function(t,i){1&t&&(e.j41(0,"ion-content")(1,"ion-item",0),e.bIt("click",function(){return i.type="update",i.confirm()}),e.nrm(2,"ion-checkbox",1),e.j41(3,"ion-label",2),e.EFF(4," Latest "),e.k0s()(),e.j41(5,"ion-item",0),e.bIt("click",function(){return i.type="beta",i.confirm()}),e.nrm(6,"ion-checkbox",1),e.j41(7,"ion-label",2),e.EFF(8," Beta "),e.k0s()(),e.j41(9,"ion-item",0),e.bIt("click",function(){return i.type="revert",i.confirm()}),e.nrm(10,"ion-checkbox",1),e.j41(11,"ion-label",2),e.EFF(12," Revert Beta "),e.k0s()()()),2&t&&(e.R7$(),e.Y8G("detail",!1),e.R7$(),e.Y8G("ngModel","update"===i.type),e.R7$(3),e.Y8G("detail",!1),e.R7$(),e.Y8G("ngModel","beta"===i.type),e.R7$(3),e.Y8G("detail",!1),e.R7$(),e.Y8G("ngModel","revert"===i.type))},dependencies:[u.eY,u.W9,u.uz,u.he,u.hB,C.BC,C.vS,te.Z],styles:[".md.update-settings-popover::part(content){margin-top:-42px;width:max-content;height:max-content}  .ios.update-settings-popover::part(content){width:max-content;height:max-content}.currentIp[_ngcontent-%COMP%]{font-size:12px;width:100%;height:12px;text-align:center;padding-top:7px;position:absolute;z-index:2}.addButton[_ngcontent-%COMP%]{--border-radius: 20px !important;height:35px;width:35px}.mat-form-field[_ngcontent-%COMP%]{font-size:6px;padding-top:1.7em}.mat-form-field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-size:15px}"],changeDetection:0}),s})();var Se=p(5580);let wi=(()=>{var o;class s{transform(t,i,n){return(t||[]).filter(a=>a[i]===n)}}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275pipe=e.EJ8({name:"filter",type:o,pure:!0}),s})(),Ri=(()=>{var o;class s{transform(t,i){return(0,w.kU)(t,i)}}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275pipe=e.EJ8({name:"validateFirmware",type:o,pure:!0}),s})();const Di=()=>({});function Pi(o,s){1&o&&e.nrm(0,"ion-progress-bar",19)}function Ei(o,s){if(1&o&&(e.j41(0,"ion-row"),e.nrm(1,"app-device",26,1),e.nI1(3,"async"),e.k0s()),2&o){const r=s.$implicit,t=e.sdS(2);e.R7$(),e.Y8G("inView","#updateContainer")("ping",e.bMT(3,5,t.isInView))("deviceInfo",r)("showDetails",!1)("reorder",!1)}}function $i(o,s){if(1&o){const r=e.RV6();e.qex(0),e.j41(1,"ion-item",20),e.bIt("click",function(){const i=e.eBV(r).$implicit,n=e.XpG(3);return e.Njj(n.selectDevice(i))}),e.j41(2,"ion-grid",21)(3,"ion-list",22),e.DNE(4,Ei,4,7,"ion-row",15),e.k0s()(),e.nrm(5,"ion-checkbox",23,0),e.nI1(7,"validateFirmware"),e.nI1(8,"validateFirmware"),e.nI1(9,"validateFirmware"),e.j41(10,"ion-button",24),e.bIt("click",function(i){const n=e.eBV(r).$implicit,a=e.XpG().ngIf,l=e.XpG(2);return i.stopImmediatePropagation(),e.Njj(l.showInfo(n.deviceInfos[0],a.firmwareList))}),e.nrm(11,"ion-icon",25),e.k0s()(),e.bVm()}if(2&o){const r=s.$implicit,t=e.XpG().ngIf,i=e.XpG().ngIf,n=e.XpG();e.R7$(),e.Y8G("disabled",i.searching),e.R7$(3),e.Y8G("ngForOf",r.deviceInfos)("ngForTrackBy",n.identifyInfo),e.R7$(),e.FS9("color",i.selectedDevices[r.id]&&"local"!==r.deviceInfos[0].deviceConStatus||e.i5U(7,8,r.deviceInfos[0],t.firmwareList)?"danger":null),e.Y8G("mode","initial")("disabled",e.i5U(8,11,r.deviceInfos[0],t.firmwareList))("ngModel",i.selectedDevices[r.id]&&"local"===r.deviceInfos[0].deviceConStatus)("indeterminate",i.selectedDevices[r.id]&&"local"!==r.deviceInfos[0].deviceConStatus||e.i5U(9,14,r.deviceInfos[0],t.firmwareList))}}function Ai(o,s){if(1&o){const r=e.RV6();e.qex(0),e.j41(1,"ion-header")(2,"ion-toolbar")(3,"ion-buttons",3)(4,"ion-button",4),e.bIt("click",function(){e.eBV(r);const i=e.XpG(2);return e.Njj(i.closeModal())}),e.nrm(5,"ion-icon",5),e.k0s()(),e.j41(6,"ion-title",6),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"ion-buttons",7)(10,"ion-button",8),e.bIt("click",function(){const i=e.eBV(r).ngIf,n=e.XpG(2);return e.Njj(n.downloadFirmwares(i.firmwareList))}),e.nrm(11,"ion-icon",9),e.k0s(),e.j41(12,"ion-button",4),e.bIt("click",function(i){e.eBV(r);const n=e.XpG(2);return e.Njj(n.presentPopover(i))}),e.nrm(13,"ion-icon",10),e.k0s()()(),e.DNE(14,Pi,1,0,"ion-progress-bar",11),e.k0s(),e.j41(15,"ion-content",12)(16,"ion-refresher",13),e.bIt("ionRefresh",function(i){e.eBV(r);const n=e.XpG(2);return e.Njj(n.checkFirmware(i))}),e.nrm(17,"ion-refresher-content"),e.k0s(),e.j41(18,"ion-list",14),e.DNE(19,$i,12,17,"ng-container",15),e.k0s()(),e.j41(20,"ion-footer")(21,"ion-toolbar")(22,"div",16),e.bIt("click",function(){const i=e.eBV(r).ngIf,n=e.XpG(2);return e.Njj(n.selectAllDevices(i.deviceInfos))}),e.nrm(23,"ion-checkbox",17),e.nI1(24,"keyvalue"),e.nI1(25,"filter"),e.nI1(26,"keyvalue"),e.nI1(27,"filter"),e.nI1(28,"keyvalue"),e.nI1(29,"filter"),e.k0s(),e.j41(30,"ion-button",18),e.bIt("click",function(){const i=e.eBV(r).ngIf,n=e.XpG(2);return e.Njj(n.updateDevices(i.deviceInfos,i.firmwareList))}),e.EFF(31),e.nI1(32,"translate"),e.k0s()()(),e.bVm()}if(2&o){const r=s.ngIf,t=e.XpG().ngIf,i=e.XpG();e.R7$(7),e.SpI(" ",e.bMT(8,10,"app.component.more.update-devices.label")," "),e.R7$(3),e.Y8G("disabled",!r.firmwareList),e.R7$(4),e.Y8G("ngIf",t.searching),e.R7$(2),e.Y8G("disabled",t.searching),e.R7$(3),e.Y8G("ngForOf",r.deviceInfos)("ngForTrackBy",i.identify),e.R7$(4),e.Y8G("indeterminate",e.brH(25,14,e.bMT(24,12,t.selectedDevices),"value",!0).length<(null==r.deviceInfos?null:r.deviceInfos.length)&&e.brH(27,20,e.bMT(26,18,t.selectedDevices),"value",!0).length>0)("checked",e.brH(29,26,e.bMT(28,24,t.selectedDevices),"value",!0).length===(null==r.deviceInfos?null:r.deviceInfos.length)),e.R7$(7),e.Y8G("disabled",t.searching||!r.firmwareList),e.R7$(),e.SpI(" ",e.bMT(32,30,"app.component.update.confirm.label")," ")}}function Vi(o,s){if(1&o&&(e.qex(0),e.DNE(1,Ai,33,32,"ng-container",2),e.nI1(2,"async"),e.bVm()),2&o){const r=e.XpG();e.R7$(),e.Y8G("ngIf",e.bMT(2,1,r.updateDevices$)||e.lJ4(3,Di))}}let Fi=(()=>{var o;class s{constructor(t,i,n,a,l,c,d,m,v){this.localService=t,this.lookupService=i,this.modalController=n,this.alertController=a,this.popoverService=l,this.popoverController=c,this.deviceInfoService=d,this.deviceUpdateService=m,this.notificationsService=v,this.state$=new q.t({selectedDevices:{}}),this.firmwares$=new q.t({}),this.type="update"}ngOnInit(){var t=this;return(0,_.A)(function*(){t.devices$=t.lookupService.subDeviceList().pipe((0,ge.o)((i,n)=>(0,ve.Y)(0===n?100:0)),(0,D.T)(i=>[...Object.keys(i)]),(0,Oe.F)(t.compareKeys),(0,Ye.n)(i=>t.mapToDeviceInfo(i)),(0,D.T)(i=>t.mapSameDevices(i))),t.checkFirmware(),t.updateDevices$=(0,Xe.z)([t.devices$,t.firmwares$]).pipe((0,D.T)(i=>t.deviceUpdateService.checkDevices(i[1],i[0],t.type,t.selectedFirmware)),(0,he.M)(i=>{for(const n of i.deviceInfos)void 0===t.state$.value.selectedDevices[n.id]&&(t.state$.value.selectedDevices[n.id]=!0);for(const n of Object.keys(t.state$.value.selectedDevices))i.deviceInfos.some(a=>a.id===n)||delete t.state$.value.selectedDevices[n];t.state$.value.selectedDevices={...t.state$.value.selectedDevices},t.state$.next(t.state$.value)}))})()}checkFirmware(t){var i=this;return(0,_.A)(function*(){i.state$.value.searching=!0,i.state$.next(i.state$.value);const n=yield i.deviceUpdateService.checkFirmwares();i.firmwares$.next(n),t&&t.target.complete(),i.state$.value.searching=!1,i.state$.next(i.state$.value)})()}showInfo(t,i){if((0,w.kU)(t,i)){var n;this.notificationsService.presentCustomToast((null==t||null===(n=t.deviceStatus)||void 0===n||null===(n=n.update)||void 0===n?void 0:n.old_version)+"<br/> - <br/>Firmware too old, update manually",5e3)}else{var a;const l=t.device.type;this.notificationsService.presentCustomToast((null==t||null===(a=t.deviceStatus)||void 0===a||null===(a=a.update)||void 0===a?void 0:a.old_version)+"<br/> - <br/>"+(i[l].version||i[l].beta_ver),5e3)}}selectDevice(t){this.state$.value.selectedDevices[t.id]=!this.state$.value.selectedDevices[t.id],this.state$.value.selectedDevices={...this.state$.value.selectedDevices},this.state$.next(this.state$.value)}selectAllDevices(t){if(t.length===Object.keys(this.state$.value.selectedDevices).filter(i=>this.state$.value.selectedDevices[i]).length)for(const i of t)this.state$.value.selectedDevices[i.id]=!1;else for(const i of t)this.state$.value.selectedDevices[i.id]=!0;this.state$.value.selectedDevices={...this.state$.value.selectedDevices},this.state$.next(this.state$.value)}downloadFirmwares(t){var i=this;return(0,_.A)(function*(){yield i.deviceUpdateService.downloadFiles(t)})()}closeModal(){var t=this;return(0,_.A)(function*(){yield t.modalController.dismiss()})()}identify(t,i){return i.id}identifyInfo(t,i){var n;return null===(n=i.device)||void 0===n?void 0:n.id}updateDevices(t,i){var n=this;return(0,_.A)(function*(){const a=t.filter(l=>{var c;return(null===(c=l.deviceInfos[0])||void 0===c?void 0:c.deviceConStatus)===A.z.local&&n.state$.value.selectedDevices[l.id]&&!(0,w.kU)(l.deviceInfos[0],i)});if(a.length>0){"select"!==n.type&&(yield n.downloadFirmwares(i)),n.state$.value.searching=!0,n.state$.next(n.state$.value);const l=yield n.deviceUpdateService.startDeviceUpdateServer();console.log(a);const c=a.map(d=>{const m=d.deviceInfos[0],v=m.device.type;let T;T="select"===n.type?n.selectedFirmware:n.deviceUpdateService.getFilename(v,i[v].version||i[v].beta_ver,i[v].url||i[v].beta_url);const y=l+"/"+T;return console.log(y),n.localService.ota(m.device,y,m.ip).pipe((0,Be.w)(1e4)).toPromise().catch(f=>(console.log(f),null))});yield Promise.all(c),yield(0,ze.of)().pipe((0,ai.c)(5e3)).toPromise(),n.notificationsService.presentCustomToast("app.component.update.done.label",3e3),n.state$.value.searching=!1,n.state$.next(n.state$.value)}else n.notificationsService.presentCustomToast("app.component.update.no-devices.label",3e3)})()}presentPopover(t){var i=this;return(0,_.A)(function*(){var n;const a=yield i.popoverController.create({component:Mi,event:t,cssClass:"update-settings-popover",translucent:!1,showBackdrop:!0,componentProps:{type:i.type}});yield a.present();const l=yield a.onWillDismiss();i.type=(null==l||null===(n=l.data)||void 0===n?void 0:n.type)||i.type,"select"===i.type&&(i.selectedFirmware=(yield i.selectFirmware(i.selectedFirmware))||i.selectedFirmware,i.selectedFirmware||(i.type="update")),i.state$.value.selectedDevices={},i.state$.value.selectedDevices={...i.state$.value.selectedDevices},i.state$.next(i.state$.value),i.firmwares$.next(i.firmwares$.value)})()}selectFirmware(t){var i=this;return(0,_.A)(function*(){yield i.popoverService.presentModal(Ti,!0,null,null,!0,void 0,document.querySelector("ion-modal"))})()}compareKeys(t,i){return JSON.stringify(t)===JSON.stringify(i)}mapToDeviceInfo(t){for(const n of t){const a=this.deviceInfoService.addPing(this.lookupService.deviceList[n]);this.deviceInfoService.removePing(a)}const i=t.map(n=>this.deviceInfoService.subDeviceInfoChange(n));return(0,Xe.z)(i)}mapSameDevices(t){const i={};for(const a of t){var n;const l=null==a||null===(n=a.device)||void 0===n||null===(n=n.id)||void 0===n?void 0:n.split("_")[0];i[l]||(i[l]=[]),i[l].push(a)}return Object.keys(i).map(a=>({id:a,deviceInfos:i[a]}))}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(Ge.n),e.rXU(X.s),e.rXU(u.W3),e.rXU(u.hG),e.rXU(Se.L),e.rXU(u.IE),e.rXU(K.E),e.rXU(Ze),e.rXU(ee.I))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-update"]],decls:2,vars:3,consts:[["checkbox",""],["inView","inView"],[4,"ngIf"],["slot","start"],["color","primary",3,"click"],["slot","icon-only","name","close"],["color","primary"],["slot","end"],["color","primary",3,"click","disabled"],["slot","icon-only","name","download-outline"],["slot","icon-only","name","settings-outline"],["type","indeterminate",4,"ngIf"],["fullscreen","true","scroll-events",""],["slot","fixed",3,"ionRefresh","disabled"],["id","updateContainer"],[4,"ngFor","ngForOf","ngForTrackBy"],[2,"left","5px","top","8px","position","absolute","width","42px","height","42px","padding","12px","z-index","2",3,"click"],["slot","start",3,"indeterminate","checked"],["expand","block","fill","outline",2,"height","48px","margin","5px",3,"click","disabled"],["type","indeterminate"],["mode","md","lines","inset","button","",3,"click","disabled"],[2,"z-index","-1"],[2,"padding","0"],["slot","start",2,"margin-left","5px","margin-right","15px","pointer-events","none",3,"mode","disabled","color","ngModel","indeterminate"],["color","primary","slot","end","shape","round",1,"infoButton",3,"click"],["slot","icon-only","name","information-outline"],[3,"inView","ping","deviceInfo","showDetails","reorder"]],template:function(t,i){1&t&&(e.DNE(0,Vi,3,4,"ng-container",2),e.nI1(1,"async")),2&t&&e.Y8G("ngIf",e.bMT(1,1,i.state$))},dependencies:[u.Jm,u.QW,u.eY,u.W9,u.M0,u.lO,u.eU,u.iq,u.uz,u.nf,u.FH,u.To,u.Ki,u.ln,u.BC,u.ai,u.hB,C.BC,C.vS,b.Sq,b.bT,re.q,se.q,te.Z,wi,Ri,b.Jj,b.lG,M.D9],styles:[".header-background{-webkit-backdrop-filter:none!important;backdrop-filter:none!important}.searchText[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;text-align:center;transform:translate(-50%,-50%)}.searchText[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{padding-bottom:10px}ion-item.oldFirmware[_ngcontent-%COMP%]{pointer-events:none}ion-item.oldFirmware[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(ion-button){opacity:.7}ion-item.oldFirmware[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{pointer-events:all}ion-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-height:100%}ion-list[_ngcontent-%COMP%] > ion-row[_ngcontent-%COMP%]:not(:last-child)     ion-progress-bar{display:none}ion-list[_ngcontent-%COMP%] > ion-row[_ngcontent-%COMP%]:last-child     ion-progress-bar{bottom:-2px!important}[_nghost-%COMP%]     app-device{width:100%}[_nghost-%COMP%]     app-device>div>div{margin-bottom:-1px}[_nghost-%COMP%]     app-device>div>div>ion-item{--border-color: transparent;pointer-events:none;opacity:1}[_nghost-%COMP%]     app-device>div>div>ion-item *:not(.infoButton), [_nghost-%COMP%]     app-device>div>div>ion-item ion-range::part(bar), [_nghost-%COMP%]     app-device>div>div>ion-item ion-range::part(knob), [_nghost-%COMP%]     app-device>div>div>ion-item ion-range::part(bar-active){pointer-events:none!important}[_nghost-%COMP%]     app-device>div>div>ion-item.item-disabled>ion-grid{opacity:.7}[_nghost-%COMP%]     app-device>div>div>ion-item:not(.item-disabled)>ion-grid{opacity:.7}.infoButton[_ngcontent-%COMP%]{height:25px;width:25px;margin-left:5px;margin-right:12px}ion-item[_ngcontent-%COMP%]{--padding-start: 12px;--inner-padding-end: 0px}ion-item[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]{padding:0}ion-item[_ngcontent-%COMP%]   ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{padding:0}ion-checkbox[_ngcontent-%COMP%]{pointer-events:none}.card[_ngcontent-%COMP%]{box-shadow:none!important;padding:0;margin:0;display:block;position:relative;font-family:var(--ion-font-family, inherit);overflow:hidden;border-radius:0!important}"],changeDetection:0}),s})();var Oi=p(7586),ji=p(7912),Ui=p(7633);const Bi=(0,ye.F3)("Share",{web:()=>p.e(1227).then(p.bind(p,1227)).then(o=>new o.ShareWeb)});var qe=p(5757);let Gi=(()=>{var o;class s{constructor(t,i,n,a,l){this.authService=t,this.alertService=i,this.lookupService=n,this.translateService=a,this.notificationsService=l}shareBackup(){var t=this;return(0,_.A)(function*(){const i=yield t.alertService.addPin(!0);if(!i)return;const n=yield ae.p.getInfo(),a=yield t.createBackup(),l=yield t.aesGcmEncrypt(JSON.stringify(a),i.pin);"web"===n.platform||"mac"===n.operatingSystem||"windows"===n.operatingSystem?yield t.downloadBackup({pin:"shellyhome"!==i.pin,data:l},"shelly-home-backup.txt"):yield t.saveBackup({pin:"shellyhome"!==i.pin,data:l},"ShellyHome/shelly-home-backup.txt")})()}saveBackup(t,i="ShellyHome/shelly-home-backup.txt"){var n=this;return(0,_.A)(function*(){if(!t)return void n.notificationsService.presentCustomToast("app.component.more.backup-download-error.label");const a=yield ae.p.getInfo();let l=P.__.External;("mac"===a.operatingSystem||"windows"===a.operatingSystem)&&(l=P.__.Documents);const c={path:i,data:JSON.stringify(t),directory:l,recursive:!0,encoding:P.Wi.UTF8},d=yield P.YA.writeFile(c).catch(()=>(n.notificationsService.presentCustomToast("app.component.more.backup-download-error.label"),null));d&&(n.notificationsService.presentCustomToast("app.component.more.backup-download-success.label"),yield Bi.share({title:"Shelly Home Backup",dialogTitle:"Shelly Home Backup",url:d.uri}))})()}createBackup(){return(0,_.A)(function*(){const t=yield R.p.keys().then(n=>n.keys),i=yield Promise.all(t.map(n=>R.p.get({key:n}).then(a=>({key:n,value:a.value}))));try{return i.reduce((a,l)=>{let c;try{c=JSON.parse(l.value)}catch{c=l.value}return a[l.key]=c,a},{})}catch{return null}})()}exportBackup(){var t=this;return(0,_.A)(function*(){const i=yield t.createBackup();t.downloadBackup(i,"shelly-home-backup.txt")})()}downloadBackup(t,i){t||this.notificationsService.presentCustomToast("app.component.more.backup-download-error.label")}loadBackup(){var t=this;return(0,_.A)(function*(){const i=window.document.createElement("input");i.type="file",i.accept=".txt",i.style.height="0px",i.style.width="0px",i.style.border="0px",i.style.position="fixed",i.style.top="50%",i.style.left="50%",document.body.appendChild(i),i.click(),i.addEventListener("change",()=>{const n=i.files[0];if(n.type.match(/text.*/)){let l=new FileReader;const c=l._realReader;c&&(l=c),l.onload=(0,_.A)(function*(){try{let d=JSON.parse(l.result);if(!1===d.pin||!0===d.pin){const m=d.pin?yield t.alertService.addPin():{pin:"shellyhome"};if(!m)return;d=yield t.aesGcmDecrypt(d.data,m.pin).then(h=>JSON.parse(h))}if(void 0===d.welcome)yield R.p.set({key:"deviceList",value:JSON.stringify(d.deviceList)}),yield R.p.set({key:"deviceStatusList",value:JSON.stringify(d.deviceStatusList)}),yield R.p.set({key:"roomList",value:JSON.stringify(d.roomList)}),yield R.p.set({key:"groupList",value:JSON.stringify(d.groupList)}),yield t.lookupService.init();else{for(const m in d)"string"==typeof d[m]?yield R.p.set({key:m,value:d[m]}):yield R.p.set({key:m,value:JSON.stringify(d[m])});yield t.lookupService.init(),t.authService.login(),t.lookupService.setDarkMode()}t.notificationsService.presentCustomToast("app.component.more.backup-load-success.label")}catch(d){console.error(d),t.notificationsService.presentCustomToast("app.component.more.backup-load-error.label")}document.body.removeChild(i)}),l.readAsText(n)}else document.body.removeChild(i),t.notificationsService.presentCustomToast("app.component.more.backup-load-error.label")})})()}writeErrorLog(){var t=this;return(0,_.A)(function*(){const i=localStorage.getItem("errorLog"),n={path:"shelly-home-error-log.txt",data:JSON.stringify(i),directory:P.__.Documents,encoding:P.Wi.UTF8},a=yield ae.p.getInfo();t.notificationsService.presentCustomToast("app.component.more.report-error-prompt.label"),yield(0,w.wR)(500);const l=t.translateService.instant("app.component.more.report-error.label"),c=("ios"===a.platform?"iOS":"android"===a.platform?"Android":"Electron")+" Version: "+a.osVersion+"\r\n\r\n"+t.translateService.instant("app.component.more.report-error-body.label")+"\r\n\r\n\r\n\r\n\r\n\r\n";let d="mailto:di.gausma@googlemail.com?subject=";d+=encodeURIComponent(l),d+="&body=",d+=encodeURIComponent(c),console.log(d),window.open(d,"_system"),P.YA.writeFile(n).then((0,_.A)(function*(){})).catch(()=>{})})()}aesGcmEncrypt(t,i){return(0,_.A)(function*(){const n=(new TextEncoder).encode(i),a=yield crypto.subtle.digest("SHA-256",n),l=crypto.getRandomValues(new Uint8Array(12)),c=Array.from(l).map(y=>String.fromCharCode(y)).join(""),d={name:"AES-GCM",iv:l},m=yield crypto.subtle.importKey("raw",a,d,!1,["encrypt"]),v=(new TextEncoder).encode(t),h=yield crypto.subtle.encrypt(d,m,v),T=Array.from(new Uint8Array(h)).map(y=>String.fromCharCode(y)).join("");return btoa(c+T)})()}aesGcmDecrypt(t,i){return(0,_.A)(function*(){const n=(new TextEncoder).encode(i),a=yield crypto.subtle.digest("SHA-256",n),l=atob(t).slice(0,12),d={name:"AES-GCM",iv:new Uint8Array(Array.from(l).map(g=>g.charCodeAt(0)))},m=yield crypto.subtle.importKey("raw",a,d,!1,["decrypt"]),v=atob(t).slice(12),h=new Uint8Array(Array.from(v).map(g=>g.charCodeAt(0)));try{const g=yield crypto.subtle.decrypt(d,m,h);return(new TextDecoder).decode(g)}catch{throw new Error("Decrypt failed")}})()}}return(o=s).\u0275fac=function(t){return new(t||o)(e.KVO(qe.u),e.KVO(oe.u),e.KVO(X.s),e.KVO(M.c$),e.KVO(ee.I))},o.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),s})();var Ni=p(2068);function Li(o,s){if(1&o&&(e.j41(0,"ion-select-option",24),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&o){const r=s.$implicit;e.FS9("value",r),e.R7$(),e.SpI(" ",e.bMT(2,2,"app.commons.languages["+r+"].label")," ")}}function Xi(o,s){if(1&o&&(e.j41(0,"ion-select-option",24),e.EFF(1),e.k0s()),2&o){const r=e.XpG().$implicit;e.FS9("value",r.id),e.R7$(),e.SpI(" ",null==r||null==r.pricing?null:r.pricing.price," ")}}function zi(o,s){if(1&o&&(e.qex(0),e.DNE(1,Xi,2,2,"ion-select-option",25),e.bVm()),2&o){const r=s.$implicit;e.R7$(),e.Y8G("ngIf",null==r||null==r.pricing?null:r.pricing.price)}}function Yi(o,s){if(1&o&&(e.j41(0,"ion-badge",26),e.EFF(1),e.k0s()),2&o){const r=s.ngIf;e.R7$(),e.JRh(r)}}function Wi(o,s){if(1&o&&(e.j41(0,"ion-badge",26),e.EFF(1),e.k0s()),2&o){const r=s.ngIf;e.R7$(),e.JRh(r)}}function Hi(o,s){1&o&&(e.j41(0,"ion-label"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&o&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"app.component.more.dark-theme.label")," "))}function Ji(o,s){1&o&&(e.j41(0,"ion-label"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&o&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"app.component.more.light-theme.label")," "))}function Ki(o,s){1&o&&(e.j41(0,"ion-label"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&o&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"app.component.more.system-theme.label")," "))}let Qi=(()=>{var o;class s{constructor(t,i,n,a,l,c,d,m,v){this.pushService=t,this.donateService=i,this.backupService=n,this.lookupService=a,this.popoverService=l,this.translateService=c,this.popoverController=d,this.deviceInfoService=m,this.actionSheetController=v,this.products=[],this.unsubscribe=new me.B}ngOnInit(){this.languages=this.translateService.getLangs(),this.products=this.donateService.getProducts(),this.settings=this.lookupService.settings,this.devices$=this.deviceInfoService.subDeviceInfos().pipe((0,D.T)(t=>{var i;return null===(i=t.filter(n=>!n.device.room_id&&!n.device.id.includes("_")&&n.deviceConStatus!==A.z.offline&&!!n.ip&&n.deviceConStatus!==A.z.ble))||void 0===i?void 0:i.length})),this.btDevices$=this.deviceInfoService.subDeviceInfos().pipe((0,D.T)(t=>{var i;return null===(i=t.filter(n=>!n.device.room_id&&!n.device.id.includes("_")&&n.deviceConStatus!==A.z.offline&&!!n.ble&&n.deviceConStatus!==A.z.local))||void 0===i?void 0:i.length}))}ngOnDestroy(){this.unsubscribe.next(),this.unsubscribe.complete()}enablePush(){this.pushService.registerPush()}applyZoom(){var t=this;return(0,_.A)(function*(){yield t.dismiss(),t.lookupService.applyZoomFactor(),t.lookupService.setSettings(t.settings)})()}onClickAddDevices(){this.popoverService.presentModal(Ne,!0,null,null,!0,void 0,document.querySelector("app-dashboard")),this.dismiss()}onClickAddBluetoothDevices(){this.popoverService.presentModal(Fe,!0,null,null,!0,void 0,document.querySelector("app-dashboard")),this.dismiss()}onClickSearch(){this.popoverService.presentModal(Le.S,!0,null,null,!0,void 0,document.querySelector("app-dashboard")),this.dismiss()}onClickUpdateDevices(){this.popoverService.presentModal(Fi,!0,null,null,!0,void 0,document.querySelector("app-dashboard")),this.dismiss()}onClickToggleTheme(){!0===this.settings.darkTheme?this.settings.darkTheme=!1:!1===this.settings.darkTheme?this.settings.darkTheme=void 0:null==this.settings.darkTheme&&(this.settings.darkTheme=!0),this.lookupService.setSettings(this.settings),this.lookupService.setDarkMode()}onLangChange(t){this.translateService.use(t),Oi.locale(t),this.settings.language=t,this.lookupService.setSettings(this.settings)}onClickDonate(t){return(0,_.A)(function*(){const i=yield ae.p.getInfo();"android"===i.platform||"ios"===i.platform?t.open():window.open("https://github.com/digaus/shellyhome-i18n/blob/master/README.md","_system","location=yes")})()}onClickReportError(){var t=this;return(0,_.A)(function*(){yield t.backupService.writeErrorLog()})()}onDonate(t){var i=this;return(0,_.A)(function*(){t&&i.donateService.order(t),i.product=null})()}onClickBackup(){var t=this;return(0,_.A)(function*(){var n;yield(yield t.actionSheetController.create({header:t.translateService.instant("app.component.more.backup.header.label"),buttons:[{text:t.translateService.instant("app.component.more.backup-do.label"),icon:"arrow-redo",handler:(n=(0,_.A)(function*(){t.backupService.shareBackup()}),function(){return n.apply(this,arguments)})},{text:t.translateService.instant("app.component.more.backup-load.label"),icon:"arrow-undo",handler:function(){var n=(0,_.A)(function*(){yield t.backupService.loadBackup()});return function(){return n.apply(this,arguments)}}()},{text:t.translateService.instant("app.component.more.cancel.label"),role:"cancel",icon:"close",handler:()=>{console.log("Cancel clicked")}}]})).present()})()}dismiss(){var t=this;return(0,_.A)(function*(){yield t.popoverController.dismiss()})()}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(ji.U),e.rXU(Ui.p),e.rXU(Gi),e.rXU(X.s),e.rXU(Se.L),e.rXU(M.c$),e.rXU(u.IE),e.rXU(K.E),e.rXU(u.GD))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-more"]],decls:74,vars:58,consts:[["langSelect",""],["donateSelect",""],[2,"display","none"],["slot","end",3,"ngModelChange","okText","cancelText","ngModel"],[3,"value",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["mode","md","lines","none","button","","detail","false",3,"click"],["color","primary","name","wifi","slot","start"],["color","primary","name","bluetooth","slot","start"],["slot","end",4,"ngIf"],["color","primary","name","search","slot","start"],["color","primary","name","sync","slot","start"],["color","primary","name","mail","slot","start",2,"height","20px"],["color","primary","name","repeat","slot","start"],["color","primary","name","contrast","slot","start"],[4,"ngIf"],["mode","md","lines","none","button","","detail","false","multiclick","",3,"singleClick","longClick"],["color","primary","name","heart","slot","start"],["color","primary","name","globe","slot","start"],["mode","md","lines","none","detail","false"],[1,"zoomDiv"],["min","100","max","150",2,"padding","28px 0 0 0",3,"ngModelChange","touchend","mouseup","pin","ngModel"],["color","primary","name","remove-circle-outline","slot","start"],["color","primary","name","add-circle-outline","slot","end"],[3,"value"],[3,"value",4,"ngIf"],["slot","end"]],template:function(t,i){if(1&t){const n=e.RV6();e.j41(0,"ion-item",2)(1,"ion-label"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"ion-select",3,0),e.nI1(6,"translate"),e.nI1(7,"translate"),e.mxI("ngModelChange",function(l){return e.eBV(n),e.DH7(i.settings.language,l)||(i.settings.language=l),e.Njj(l)}),e.bIt("ngModelChange",function(l){return e.eBV(n),e.Njj(i.onLangChange(l))}),e.DNE(8,Li,3,4,"ion-select-option",4),e.k0s()(),e.j41(9,"ion-item",2)(10,"ion-label"),e.EFF(11),e.nI1(12,"translate"),e.k0s(),e.j41(13,"ion-select",3,1),e.nI1(15,"translate"),e.nI1(16,"translate"),e.mxI("ngModelChange",function(l){return e.eBV(n),e.DH7(i.product,l)||(i.product=l),e.Njj(l)}),e.bIt("ngModelChange",function(l){return e.eBV(n),e.Njj(i.onDonate(l))}),e.DNE(17,zi,2,1,"ng-container",5),e.k0s()(),e.j41(18,"ion-list")(19,"ion-item",6),e.bIt("click",function(){return e.eBV(n),e.Njj(i.onClickAddDevices())}),e.nrm(20,"ion-icon",7),e.j41(21,"ion-label"),e.EFF(22),e.nI1(23,"translate"),e.k0s()(),e.j41(24,"ion-item",6),e.bIt("click",function(){return e.eBV(n),e.Njj(i.onClickAddBluetoothDevices())}),e.nrm(25,"ion-icon",8),e.j41(26,"ion-label"),e.EFF(27),e.nI1(28,"translate"),e.k0s(),e.DNE(29,Yi,2,1,"ion-badge",9),e.nI1(30,"async"),e.k0s(),e.j41(31,"ion-item",6),e.bIt("click",function(){return e.eBV(n),e.Njj(i.onClickSearch())}),e.nrm(32,"ion-icon",10),e.j41(33,"ion-label"),e.EFF(34),e.nI1(35,"translate"),e.k0s(),e.DNE(36,Wi,2,1,"ion-badge",9),e.nI1(37,"async"),e.k0s(),e.j41(38,"ion-item",6),e.bIt("click",function(){return e.eBV(n),e.Njj(i.onClickUpdateDevices())}),e.nrm(39,"ion-icon",11),e.j41(40,"ion-label"),e.EFF(41),e.nI1(42,"translate"),e.k0s()(),e.j41(43,"ion-item",6),e.bIt("click",function(){return e.eBV(n),e.Njj(i.onClickReportError())}),e.nrm(44,"ion-icon",12),e.j41(45,"ion-label"),e.EFF(46),e.nI1(47,"translate"),e.k0s()(),e.j41(48,"ion-item",6),e.bIt("click",function(){return e.eBV(n),e.Njj(i.onClickBackup())}),e.nrm(49,"ion-icon",13),e.j41(50,"ion-label"),e.EFF(51),e.nI1(52,"translate"),e.k0s()(),e.j41(53,"ion-item",6),e.bIt("click",function(){return e.eBV(n),e.Njj(i.onClickToggleTheme())}),e.nrm(54,"ion-icon",14),e.DNE(55,Hi,3,3,"ion-label",15)(56,Ji,3,3,"ion-label",15)(57,Ki,3,3,"ion-label",15),e.k0s(),e.j41(58,"ion-item",16),e.bIt("singleClick",function(){e.eBV(n);const l=e.sdS(14);return e.Njj(i.onClickDonate(l))})("longClick",function(){return e.eBV(n),e.Njj(i.enablePush())}),e.nrm(59,"ion-icon",17),e.j41(60,"ion-label"),e.EFF(61),e.nI1(62,"translate"),e.k0s()(),e.j41(63,"ion-item",6),e.bIt("click",function(){e.eBV(n);const l=e.sdS(5);return e.Njj(l.open())}),e.nrm(64,"ion-icon",18),e.j41(65,"ion-label"),e.EFF(66),e.nI1(67,"translate"),e.k0s()(),e.j41(68,"ion-item",19)(69,"div",20),e.EFF(70),e.k0s(),e.j41(71,"ion-range",21),e.mxI("ngModelChange",function(l){return e.eBV(n),e.DH7(i.settings.zoomFactor,l)||(i.settings.zoomFactor=l),e.Njj(l)}),e.bIt("touchend",function(){return e.eBV(n),e.Njj(i.applyZoom())})("mouseup",function(){return e.eBV(n),e.Njj(i.applyZoom())}),e.nrm(72,"ion-icon",22)(73,"ion-icon",23),e.k0s()()()}2&t&&(e.R7$(2),e.JRh(e.bMT(3,26,"app.component.more.language.label")),e.R7$(2),e.Y8G("okText",e.bMT(6,28,"app.commons.confirm.label"))("cancelText",e.bMT(7,30,"app.commons.cancel.label")),e.R50("ngModel",i.settings.language),e.R7$(4),e.Y8G("ngForOf",i.languages),e.R7$(3),e.JRh(e.bMT(12,32,"app.component.more.donate.label")),e.R7$(2),e.Y8G("okText",e.bMT(15,34,"app.commons.confirm.label"))("cancelText",e.bMT(16,36,"app.commons.cancel.label")),e.R50("ngModel",i.product),e.R7$(4),e.Y8G("ngForOf",i.products),e.R7$(5),e.SpI(" ",e.bMT(23,38,"app.component.more.add-devices.label")," "),e.R7$(5),e.SpI(" ",e.bMT(28,40,"app.component.more.add-bt-devices.label")," "),e.R7$(2),e.Y8G("ngIf",e.bMT(30,42,i.btDevices$)),e.R7$(5),e.SpI(" ",e.bMT(35,44,"app.component.more.search-devices.label")," "),e.R7$(2),e.Y8G("ngIf",e.bMT(37,46,i.devices$)),e.R7$(5),e.SpI(" ",e.bMT(42,48,"app.component.more.update-devices.label")," "),e.R7$(5),e.SpI(" ",e.bMT(47,50,"app.component.more.report-error.label")," "),e.R7$(5),e.SpI(" ",e.bMT(52,52,"app.component.more.backup.label")," "),e.R7$(4),e.Y8G("ngIf",!0===(null==i.settings?null:i.settings.darkTheme)),e.R7$(),e.Y8G("ngIf",!1===(null==i.settings?null:i.settings.darkTheme)),e.R7$(),e.Y8G("ngIf",null==(null==i.settings?null:i.settings.darkTheme)),e.R7$(4),e.JRh(e.bMT(62,54,"app.component.more.donate.label")),e.R7$(5),e.SpI("",e.bMT(67,56,"app.commons.languages["+(null==i.settings?null:i.settings.language)+"].label")," "),e.R7$(4),e.SpI("",i.settings.zoomFactor||"100","%"),e.R7$(),e.Y8G("pin",!0),e.R50("ngModel",i.settings.zoomFactor))},dependencies:[u.In,u.iq,u.uz,u.he,u.nf,u.Ob,u.Nm,u.Ip,u.Je,u.Gw,C.BC,C.vS,b.Sq,b.bT,te.Z,Ni.f,b.Jj,M.D9],styles:["ion-item[_ngcontent-%COMP%]:not(:last-child){height:45px}ion-item[_ngcontent-%COMP%]:not(:last-child)   ion-icon.md[_ngcontent-%COMP%]{margin-right:15px;margin-top:9px}ion-item[_ngcontent-%COMP%]:not(:last-child)   ion-icon.ios[_ngcontent-%COMP%]{margin-right:15px;margin-top:9px}ion-item[_ngcontent-%COMP%]:not(:last-child)   ion-label.ios[_ngcontent-%COMP%]{margin-top:4px}ion-item[_ngcontent-%COMP%]:not(:last-child) > *[_ngcontent-%COMP%]{white-space:pre-line}ion-item[_ngcontent-%COMP%]:not(:last-child) > ion-badge[_ngcontent-%COMP%]{border-radius:10px;padding-top:5px}ion-item[_ngcontent-%COMP%]:not(:last-child)::part(native){max-height:45px}ion-list.list-ios[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:10px}  .md.more-popover::part(content){margin-top:-42px;width:max-content;height:max-content;--max-width: 275px;--min-width: 260px}  .ios.more-popover::part(content){width:max-content;height:max-content;--max-width: 275px;--min-width: 260px}  .ios .action-sheet-icon{position:absolute!important;left:10px}  .ios .action-sheet-button-inner{padding:0 50px}.zoomDiv[_ngcontent-%COMP%]{position:absolute;left:50%;transform:translate(calc(-50% - 10px))}"],changeDetection:0}),s})();var xe=p(1293),Zi=p(5692),qi=p(9125),en=p(73),tn=p(7151),nn=p(2230);let on=(()=>{var o;class s{constructor(t){this.lookupService=t}transform(t){return this.lookupService.subRoomList().pipe((0,D.T)(i=>i[t]))}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(X.s,16))},o.\u0275pipe=e.EJ8({name:"room",type:o,pure:!0}),s})(),rn=(()=>{var o;class s{constructor(t){this.lookupService=t}transform(t){return this.lookupService.subGroupList().pipe((0,D.T)(i=>i[t]))}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(X.s,16))},o.\u0275pipe=e.EJ8({name:"group",type:o,pure:!0}),s})();var sn=p(954);let an=(()=>{var o;class s{transform(t,i){return(0,_.A)(function*(){return yield(0,w.wR)(i),t})()}}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275pipe=e.EJ8({name:"delay",type:o,pure:!0}),s})();const ln=["swiperComponent"];function cn(o,s){return this.identify(null,s)}const dn=()=>["open","graph"],et=()=>[];function un(o,s){if(1&o&&(e.j41(0,"ion-badge",31),e.EFF(1),e.k0s()),2&o){const r=s.ngIf;e.R7$(),e.JRh(r)}}function pn(o,s){if(1&o){const r=e.RV6();e.j41(0,"ion-fab-button",32),e.bIt("click",function(){e.eBV(r);const i=e.XpG(2);return e.Njj(i.removeDashboard())}),e.nrm(1,"ion-icon",33),e.k0s()}}function _n(o,s){if(1&o){const r=e.RV6();e.j41(0,"ion-fab-button",14),e.bIt("click",function(){e.eBV(r);const i=e.XpG(2);return e.Njj(i.onClickAdd())}),e.nrm(1,"ion-icon",34),e.k0s()}}function mn(o,s){if(1&o){const r=e.RV6();e.j41(0,"ion-fab-button",35),e.bIt("click",function(){e.eBV(r);const i=e.XpG(2);return e.Njj(i.editDashboard())}),e.nrm(1,"ion-icon",36),e.k0s()}}function hn(o,s){if(1&o){const r=e.RV6();e.j41(0,"ion-fab-button",38),e.bIt("click",function(){e.eBV(r);const i=e.XpG(3);return e.Njj(i.slideLeft())}),e.nrm(1,"ion-icon",39),e.k0s()}}function vn(o,s){if(1&o&&(e.j41(0,"ion-fab",20),e.DNE(1,hn,2,0,"ion-fab-button",37),e.k0s()),2&o){const r=e.XpG(2);e.R7$(),e.Y8G("ngIf",!r.reorder)}}function gn(o,s){if(1&o){const r=e.RV6();e.j41(0,"ion-fab-button",38),e.bIt("click",function(){e.eBV(r);const i=e.XpG(3);return e.Njj(i.slideRight())}),e.nrm(1,"ion-icon",40),e.k0s()}}function fn(o,s){if(1&o&&(e.j41(0,"ion-fab",24),e.DNE(1,gn,2,0,"ion-fab-button",37),e.k0s()),2&o){const r=e.XpG(2);e.R7$(),e.Y8G("ngIf",!r.reorder)}}function bn(o,s){1&o&&(e.j41(0,"div",42)(1,"ion-title",43),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&o&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"app.component.dashboard.empty-list.label")," "))}function yn(o,s){if(1&o){const r=e.RV6();e.DNE(0,bn,4,3,"ng-template",41),e.bIt("click",function(){e.eBV(r);const i=e.XpG(2);return e.Njj(i.addDashboard())})}}function kn(o,s){1&o&&(e.j41(0,"ion-title",43),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&o&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"app.component.dashboard.empty.label")," "))}function In(o,s){if(1&o){const r=e.RV6();e.j41(0,"ion-fab-button",54),e.bIt("click",function(){e.eBV(r);const i=e.XpG().$index,n=e.XpG().index,a=e.XpG(3).index,l=e.XpG(2);return e.Njj(l.removeElement(a,n,i))}),e.nrm(1,"ion-icon",55),e.k0s()}}function Sn(o,s){1&o&&(e.j41(0,"div",60),e.nrm(1,"ion-icon",61)(2,"div"),e.k0s())}function xn(o,s){if(1&o){const r=e.RV6();e.j41(0,"div",62)(1,"ion-fab-button",63),e.bIt("click",function(){const i=e.eBV(r).$implicit,n=e.XpG(3).$index,a=e.XpG().index,l=e.XpG(3).index,c=e.XpG(2);return e.Njj(c.customizeElement(l,a,n,i))}),e.nrm(2,"ion-icon",64),e.k0s()()}}function Cn(o,s){if(1&o){const r=e.RV6();e.j41(0,"app-device",58,1),e.nI1(2,"async"),e.mxI("dashboardSettingsChange",function(i){const n=e.eBV(r).ngIf,a=e.XpG(2).$implicit;return e.DH7(a.devices[null==n||null==n.device||null==n.device.id?null:n.device.id.id],i)||(a.devices[null==n||null==n.device||null==n.device.id?null:n.device.id.id]=i),e.Njj(i)}),e.bIt("dashboardSettingsChange",function(){e.eBV(r);const i=e.XpG(8);return e.Njj(i.saveSettings())}),e.DNE(3,Sn,3,0,"div",59)(4,xn,3,0,"ng-template",null,2,e.C5r),e.k0s()}if(2&o){const r=s.ngIf,t=e.sdS(1),i=e.XpG(2).$implicit,n=e.XpG(6);e.Y8G("allow",e.lJ4(9,dn))("ping",e.bMT(2,7,t.isInView))("deviceInfo",r),e.R50("dashboardSettings",i.devices[null==r||null==r.device?null:r.device.id]),e.Y8G("showDetails",!1)("reorder",n.reorder),e.R7$(3),e.Y8G("ngIf",n.reorder)}}function Tn(o,s){if(1&o&&(e.j41(0,"ion-card",56),e.DNE(1,Cn,6,10,"app-device",57),e.nI1(2,"deviceInfo"),e.nI1(3,"async"),e.k0s()),2&o){const r=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",e.bMT(3,3,e.bMT(2,1,r.key)))}}function Mn(o,s){1&o&&(e.j41(0,"div",60),e.nrm(1,"ion-icon",61),e.k0s())}function wn(o,s){if(1&o){const r=e.RV6();e.j41(0,"div",62)(1,"ion-fab-button",63),e.bIt("click",function(){const i=e.eBV(r).$implicit,n=e.XpG(3).$index,a=e.XpG().index,l=e.XpG(3).index,c=e.XpG(2);return e.Njj(c.customizeElement(l,a,n,i))}),e.nrm(2,"ion-icon",64),e.k0s()()}}function Rn(o,s){if(1&o){const r=e.RV6();e.j41(0,"app-room",67,1),e.nI1(2,"async"),e.mxI("dashboardSettingsChange",function(i){e.eBV(r);const n=e.XpG(2).$implicit;return e.DH7(n.devices,i)||(n.devices=i),e.Njj(i)}),e.bIt("dashboardSettingsChange",function(){e.eBV(r);const i=e.XpG(8);return e.Njj(i.saveSettings())})("select",function(){e.eBV(r);const i=e.XpG(2).$index,n=e.XpG().index,a=e.XpG(3).index,l=e.XpG(2);return e.Njj(l.collapsedChanged(a,n,i))})("controlButtonsChange",function(){e.eBV(r);const i=e.XpG(2).$index,n=e.XpG().index,a=e.XpG(3).index,l=e.XpG(2);return e.Njj(l.controlButtonsChanged(a,n,i))}),e.DNE(3,Mn,2,0,"div",59)(4,wn,3,0,"ng-template",null,3,e.C5r),e.k0s()}if(2&o){const r=s.ngIf,t=e.sdS(1),i=e.XpG(2).$implicit,n=e.XpG(6);e.AVh("collapsed",i.collapsed)("not-collapsed",!i.collapsed),e.Y8G("ping",e.bMT(2,12,t.isInView))("room",r)("allow",e.lJ4(14,et))("reorder",n.reorder)("collapsed",i.collapsed),e.R50("dashboardSettings",i.devices),e.Y8G("controlButtons",i.controlButtons),e.R7$(3),e.Y8G("ngIf",n.reorder)}}function Dn(o,s){if(1&o&&(e.j41(0,"div",65),e.DNE(1,Rn,6,15,"app-room",66),e.nI1(2,"room"),e.nI1(3,"async"),e.k0s()),2&o){const r=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",e.bMT(3,3,e.bMT(2,1,r.key)))}}function Pn(o,s){1&o&&(e.j41(0,"div",60),e.nrm(1,"ion-icon",61)(2,"div"),e.k0s())}function En(o,s){if(1&o){const r=e.RV6();e.j41(0,"div",62)(1,"ion-fab-button",63),e.bIt("click",function(){const i=e.eBV(r).$implicit,n=e.XpG(3).$index,a=e.XpG().index,l=e.XpG(3).index,c=e.XpG(2);return e.Njj(c.customizeElement(l,a,n,i))}),e.nrm(2,"ion-icon",64),e.k0s()()}}function $n(o,s){if(1&o){const r=e.RV6();e.j41(0,"app-group",69,1),e.nI1(2,"delay"),e.nI1(3,"async"),e.nI1(4,"async"),e.mxI("dashboardSettingsChange",function(i){e.eBV(r);const n=e.XpG(2).$implicit;return e.DH7(n.devices,i)||(n.devices=i),e.Njj(i)}),e.bIt("dashboardSettingsChange",function(){e.eBV(r);const i=e.XpG(8);return e.Njj(i.saveSettings())})("select",function(){e.eBV(r);const i=e.XpG(2).$index,n=e.XpG().index,a=e.XpG(3).index,l=e.XpG(2);return e.Njj(l.collapsedChanged(a,n,i))})("controlButtonsChange",function(){e.eBV(r);const i=e.XpG(2).$index,n=e.XpG().index,a=e.XpG(3).index,l=e.XpG(2);return e.Njj(l.controlButtonsChanged(a,n,i))}),e.DNE(5,Pn,3,0,"div",59)(6,En,3,0,"ng-template",null,4,e.C5r),e.k0s()}if(2&o){const r=s.ngIf,t=e.sdS(1),i=e.XpG(2).$implicit,n=e.XpG(6);e.AVh("collapsedDisplay",e.bMT(3,17,e.i5U(2,14,i.collapsed,i.collapsed?200:20)))("collapsed",i.collapsed)("not-collapsed",!i.collapsed),e.Y8G("ping",e.bMT(4,19,t.isInView))("group",r)("allow",e.lJ4(21,et))("reorder",n.reorder)("collapsed",i.collapsed),e.R50("dashboardSettings",i.devices),e.Y8G("controlButtons",i.controlButtons),e.R7$(5),e.Y8G("ngIf",n.reorder)}}function An(o,s){if(1&o&&(e.j41(0,"div",65),e.DNE(1,$n,8,22,"app-group",68),e.nI1(2,"group"),e.nI1(3,"async"),e.k0s()),2&o){const r=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf",e.bMT(3,3,e.bMT(2,1,r.key)))}}function Vn(o,s){if(1&o){const r=e.RV6();e.j41(0,"div",50),e.bIt("cdkDragStarted",function(){e.eBV(r);const i=e.XpG(6);return e.Njj(i.onDragStart())}),e.DNE(1,In,2,0,"ion-fab-button",51)(2,Tn,4,5,"ion-card",52)(3,Dn,4,5,"div",53)(4,An,4,5,"div",53),e.k0s()}if(2&o){const r=s.$implicit,t=e.XpG(6);e.Y8G("cdkDragData",r)("cdkDragDisabled",!t.reorder),e.R7$(),e.Y8G("ngIf",t.reorder),e.R7$(),e.Y8G("ngIf","device"===r.type),e.R7$(),e.Y8G("ngIf","room"===r.type),e.R7$(),e.Y8G("ngIf","group"===r.type)}}function Fn(o,s){if(1&o){const r=e.RV6();e.j41(0,"ion-col",47),e.nI1(1,"async"),e.nI1(2,"dropListConnected"),e.nI1(3,"async"),e.bIt("cdkDropListDropped",function(i){e.eBV(r);const n=e.XpG(5);return e.Njj(n.drop(i))})("click",function(){const i=e.eBV(r).$implicit,n=e.XpG(5);return e.Njj(null!=i&&i.length?null:n.onClickAdd())}),e.DNE(4,kn,3,3,"ion-title",48),e.Z7z(5,Vn,5,6,"div",49,cn,!0),e.k0s()}if(2&o){const r=s.$implicit,t=s.index,i=e.XpG(3).$implicit,n=e.XpG(2);e.xc7("width",100/i.cols.length+"%"),e.Y8G("cdkDropListData",r)("cdkDropListConnectedTo",e.i5U(2,8,i.cols,e.bMT(1,6,n.currentSlide$)))("id","dashboard"+e.bMT(3,11,n.currentSlide$)+"Col"+t),e.R7$(4),e.Y8G("ngIf",!(null!=r&&r.length)),e.R7$(),e.Dyx(r)}}function On(o,s){if(1&o&&(e.j41(0,"ion-row"),e.DNE(1,Fn,7,13,"ion-col",46),e.k0s()),2&o){const r=e.XpG(2).$implicit,t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",r.cols)("ngForTrackBy",t.identifyIndex)}}function jn(o,s){if(1&o&&(e.j41(0,"ion-grid",45)(1,"ion-list"),e.DNE(2,On,2,2,"ion-row",5),e.nI1(3,"async"),e.k0s()()),2&o){const r=e.XpG().index,t=e.XpG(2);e.R7$(2),e.Y8G("ngIf",e.bMT(3,1,t.currentSlide$)===r)}}function Un(o,s){1&o&&e.DNE(0,jn,4,3,"ng-template",44)}function Bn(o,s){if(1&o){const r=e.RV6();e.qex(0),e.j41(1,"ion-header",6)(2,"ion-toolbar")(3,"ion-buttons",7)(4,"ion-menu-button",8),e.nrm(5,"ion-icon",9),e.k0s(),e.j41(6,"ion-button",10),e.nI1(7,"async"),e.bIt("click",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.selectUser())}),e.nrm(8,"ion-icon",11),e.k0s()(),e.j41(9,"ion-title",12),e.EFF(10,"Dashboard"),e.k0s(),e.j41(11,"ion-buttons",13)(12,"ion-button",14),e.bIt("click",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.reorder=!i.reorder)}),e.nrm(13,"ion-icon",15),e.k0s(),e.j41(14,"ion-button",10),e.bIt("click",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.onClickAddDevices())}),e.nrm(15,"ion-icon",16),e.k0s(),e.DNE(16,un,2,1,"ion-badge",17),e.nI1(17,"async"),e.j41(18,"ion-button",10),e.bIt("click",function(i){e.eBV(r);const n=e.XpG();return e.Njj(n.presentPopover(i))}),e.nrm(19,"ion-icon",18),e.k0s()()()(),e.j41(20,"ion-content",19)(21,"ion-fab",20),e.DNE(22,pn,2,0,"ion-fab-button",21),e.k0s(),e.j41(23,"ion-fab",22),e.DNE(24,_n,2,0,"ion-fab-button",23),e.k0s(),e.j41(25,"ion-fab",24),e.DNE(26,mn,2,0,"ion-fab-button",25),e.k0s(),e.DNE(27,vn,2,1,"ion-fab",26),e.nI1(28,"async"),e.DNE(29,fn,2,1,"ion-fab",27),e.nI1(30,"async"),e.j41(31,"div",28)(32,"app-swiper",29,0),e.bIt("slideChange",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.slidesDidChange())}),e.DNE(34,yn,1,0,null,5)(35,Un,1,0,null,30),e.k0s()()(),e.j41(36,"ion-footer",6),e.nrm(37,"ion-toolbar"),e.k0s(),e.bVm()}if(2&o){let r;const t=s.ngIf,i=e.XpG();e.R7$(4),e.Y8G("menu","first"),e.R7$(2),e.Y8G("disabled",i.reorder||"connecting"===e.bMT(7,15,i.cloudStatus$)),e.R7$(7),e.Y8G("name",i.reorder?"checkmark-done-sharp":"create-outline"),e.R7$(),e.Y8G("disabled",i.reorder),e.R7$(2),e.Y8G("ngIf",null==(r=e.bMT(17,17,i.searchDevices$))?null:r.length),e.R7$(2),e.Y8G("disabled",i.reorder),e.R7$(2),e.Y8G("fullscreen",!0),e.R7$(2),e.Y8G("ngIf",i.reorder),e.R7$(2),e.Y8G("ngIf",i.reorder),e.R7$(2),e.Y8G("ngIf",i.reorder),e.R7$(),e.Y8G("ngIf",e.bMT(28,19,i.currentSlide$)>0),e.R7$(2),e.Y8G("ngIf",(null==t?null:t.length)-1>e.bMT(30,21,i.currentSlide$)),e.R7$(3),e.Y8G("config",i.slideConfig),e.R7$(2),e.Y8G("ngIf",!(null!=t&&t.length)),e.R7$(),e.Y8G("ngForOf",t)}}const Gn=[{path:"",component:(()=>{var o;class s{constructor(t,i,n,a,l,c,d,m,v,h,g){this.renderer2=t,this.authService=i,this.alertService=n,this.lookupService=a,this.modalController=l,this.popoverService=c,this.translateService=d,this.bluetoothService=m,this.deviceInfoService=v,this.popoverController=h,this.actionSheetController=g,this.slideConfig={slidesPerView:1,centeredSlides:!0,noSwipingClass:"range-wrapper,canvas,.cdk-drag-handle"},this.currentSlide$=new q.t(0)}ngOnInit(){kt.q.addListener("appStateChange",t=>{t.isActive&&this.swiperComponent.getSwiper().then(i=>i.update())}),It.S.hide(),R.p.set({key:xe.Z.welcome,value:"done"}),this.deviceInfoService.init(),this.dashboardList$=this.lookupService.subDashboardList().pipe((0,D.T)(t=>(t.forEach(i=>i.cols.forEach(n=>n.forEach(a=>{a.devices=a.devices||{},a.collapsed=a.collapsed||!1,a.controlButtons=a.controlButtons||!1}))),t)),(0,he.M)(t=>{var i;t[this.currentSlide$.value]||null===(i=this.swiperComponent)||void 0===i||null===(i=i.getSwiper())||void 0===i||i.then(n=>n.slideTo(0)),console.log(t)})),this.searchDevices$=this.deviceInfoService.subDeviceInfos().pipe((0,D.T)(t=>t.filter(i=>!i.device.room_id&&!i.device.id.includes("_")&&i.deviceConStatus!==A.z.offline&&i.deviceConStatus!==A.z.cloud)),(0,St.t)(1)),this.cloudStatus$=this.authService.cloudStatus.asObservable()}selectUser(){var t=this;return(0,_.A)(function*(){var i;if((null===(i=t.lookupService.userList)||void 0===i||null===(i=i.users)||void 0===i?void 0:i.length)>0){const n=yield t.alertService.selectUser(t.lookupService.userList);if(n){t.lookupService.selectUser(n);const a=[R.p.set({key:xe.Z.email,value:n.email}),R.p.set({key:xe.Z.password,value:n.password})];yield Promise.all(a),yield t.authService.login(null,null)}}else yield(yield t.modalController.create({component:si.C,backdropDismiss:!0,canDismiss:!0,presentingElement:document.querySelector("app-dashboard")})).present()})()}removeElement(t,i,n){this.lookupService.dashboardList[t].cols[i].splice(n,1),this.lookupService.setDashboardList(this.lookupService.dashboardList)}customizeElement(t,i,n,a){var l=this;return(0,_.A)(function*(){var c,d,m;const v=yield l.modalController.create({component:Ft,cssClass:"dashboardModal",backdropDismiss:!0,canDismiss:!0,presentingElement:document.querySelector("app-dashboard"),componentProps:{deviceId:a,selectedLayout:null===(c=l.lookupService.dashboardList[t].cols[i][n])||void 0===c||null===(c=c.devices)||void 0===c||null===(c=c[a])||void 0===c?void 0:c.layout,graphSettings:null===(d=l.lookupService.dashboardList[t].cols[i][n])||void 0===d||null===(d=d.devices)||void 0===d||null===(d=d[a])||void 0===d?void 0:d.graphSettings,loadSettings:null===(m=l.lookupService.dashboardList[t].cols[i][n])||void 0===m||null===(m=m.devices)||void 0===m||null===(m=m[a])||void 0===m?void 0:m.loadSettings}});yield v.present();const h=yield v.onWillDismiss();var g;h.data&&(l.lookupService.dashboardList[t].cols[i][n].devices[a]={...l.lookupService.dashboardList[t].cols[i][n].devices[a],layout:null===(g=h.data)||void 0===g?void 0:g.selectedLayout},l.lookupService.dashboardList[t].cols[i][n]=(0,$e.cloneDeep)(l.lookupService.dashboardList[t].cols[i][n]),l.lookupService.setDashboardList(l.lookupService.dashboardList))})()}collapsedChanged(t,i,n){this.lookupService.dashboardList[t].cols[i][n].collapsed=!this.lookupService.dashboardList[t].cols[i][n].collapsed,this.lookupService.setDashboardList(this.lookupService.dashboardList)}controlButtonsChanged(t,i,n){var a=this;return(0,_.A)(function*(){yield(0,w.wR)(10),a.lookupService.dashboardList[t].cols[i][n].controlButtons=!a.lookupService.dashboardList[t].cols[i][n].controlButtons,a.lookupService.setDashboardList(a.lookupService.dashboardList)})()}saveSettings(){this.lookupService.setDashboardList(this.lookupService.dashboardList),this.lookupService.setSettings(this.lookupService.settings)}presentPopover(t){var i=this;return(0,_.A)(function*(){var n;const a=yield i.popoverController.create({component:Qi,event:t,cssClass:"more-popover",translucent:!1,showBackdrop:!0});yield a.present(),yield a.onDidDismiss(),yield(0,w.wR)(200),null===(n=i.swiperComponent)||void 0===n||null===(n=n.getSwiper())||void 0===n||n.then(l=>l.update())})()}slideLeft(){var t;null===(t=this.swiperComponent)||void 0===t||null===(t=t.getSwiper())||void 0===t||t.then(i=>i.slidePrev())}slideRight(){var t;null===(t=this.swiperComponent)||void 0===t||null===(t=t.getSwiper())||void 0===t||t.then(i=>i.slideNext())}addDashboard(){var t=this;return(0,_.A)(function*(){const i=yield t.alertService.addDashboard();if(i.cols){var n;const a=Array.from({length:i.cols}).map(()=>[]);t.lookupService.dashboardList.push({cols:a}),t.lookupService.setDashboardList(t.lookupService.dashboardList),yield(0,w.wR)(200),null===(n=t.swiperComponent)||void 0===n||null===(n=n.getSwiper())||void 0===n||n.then(l=>l.slideTo(t.lookupService.dashboardList.length+1))}})()}editDashboard(){var t=this;return(0,_.A)(function*(){var i;const n=yield t.alertService.addDashboard(null===(i=t.lookupService.dashboardList[t.currentSlide$.value])||void 0===i||null===(i=i.cols)||void 0===i?void 0:i.length,!0);if(n.cols){var a;const l=Array.from({length:n.cols}).map((c,d)=>{var m;return(null===(m=t.lookupService.dashboardList[t.currentSlide$.value])||void 0===m||null===(m=m.cols)||void 0===m?void 0:m[d])||[]});null!==(a=t.lookupService.dashboardList[t.currentSlide$.value])&&void 0!==a&&a.cols&&(t.lookupService.dashboardList[t.currentSlide$.value].cols=l),t.lookupService.setDashboardList(t.lookupService.dashboardList)}})()}drop(t){t.previousContainer===t.container?(0,j.HD)(t.container.data,t.previousIndex,t.currentIndex):(0,j.eg)(t.previousContainer.data,t.container.data,t.previousIndex,t.currentIndex),this.lookupService.setDashboardList(this.lookupService.dashboardList)}identifyIndex(t,i){return t}identify(t,i){const n=Object.keys(i.devices).map(a=>i.devices[a].layout).join(",");return i.key+i.type+n}onDragStart(){this.renderer2.setStyle(document.getElementsByClassName("cdk-drag-placeholder")[0],"height",document.getElementsByClassName("cdk-drag-preview")[0].clientHeight+"px")}slidesDidChange(){var t=this;return(0,_.A)(function*(){var i;const n=(yield null===(i=t.swiperComponent)||void 0===i||null===(i=i.getSwiper())||void 0===i?void 0:i.then(a=>a.activeIndex))||0;yield(0,w.wR)(100),t.currentSlide$.next(n)})()}removeDashboard(){var t=this;return(0,_.A)(function*(){var i,n;if(t.reorder=!1,yield null===(i=t.swiperComponent)||void 0===i||null===(i=i.getSwiper())||void 0===i?void 0:i.then(l=>l.isLocked=!1),t.lookupService.dashboardList.splice(t.currentSlide$.value,1),t.lookupService.dashboardList=[...t.lookupService.dashboardList],t.lookupService.setDashboardList(t.lookupService.dashboardList),t.currentSlide$.value>=1)yield null===(n=t.swiperComponent)||void 0===n||null===(n=n.getSwiper())||void 0===n?void 0:n.then(l=>l.slideTo(t.currentSlide$.value-1));else if(t.lookupService.dashboardList.length>1){var a;yield null===(a=t.swiperComponent)||void 0===a||null===(a=a.getSwiper())||void 0===a?void 0:a.then(l=>l.slideTo(0))}})()}onClickAddDevices(){var t=this;return(0,_.A)(function*(){const i=yield t.actionSheetController.create({mode:"ios",header:t.translateService.instant("app.component.more.add-devices.label"),buttons:[{text:t.translateService.instant("app.component.dashboard.add-device-wifi.header.label"),icon:"wifi",handler:()=>(t.popoverService.presentModal(Ne,!0,null,null,!0,void 0,document.querySelector("app-dashboard")),!1)},{text:t.translateService.instant("app.component.dashboard.add-device-ble.header.label"),icon:"bluetooth",id:"bluetoothAction",handler:()=>(t.popoverService.presentModal(Fe,!0,null,null,!0,void 0,document.querySelector("app-dashboard")),!1)},{text:t.translateService.instant("app.component.dashboard.search-device.header.label"),icon:"search",id:"searchAction",handler:()=>(t.popoverService.presentModal(Le.S,!0,null,null,!0,void 0,document.querySelector("app-dashboard")),!1)},{text:t.translateService.instant("app.component.dashboard.cancel.header.label"),role:"cancel",icon:"close",handler:()=>{}}]});i.present();let n=0,a=0;const l=t.searchDevices$.subscribe(c=>{var d,m,v,h;(null===(d=c.filter(g=>!!g.ip&&"ble"!==g.deviceConStatus))||void 0===d?void 0:d.length)!==n&&(n=null===(v=c.filter(g=>!!g.ip&&"ble"!==g.deviceConStatus))||void 0===v?void 0:v.length,t.addEl("searchAction","app.component.dashboard.search-device.header.label",n)),(null===(m=c.filter(g=>!!g.ble&&"local"!==g.deviceConStatus))||void 0===m?void 0:m.length)!==a&&(a=null===(h=c.filter(g=>!!g.ble&&"local"!==g.deviceConStatus))||void 0===h?void 0:h.length,t.addEl("bluetoothAction","app.component.dashboard.add-device-ble.header.label",a))});yield i.onWillDismiss(),l.unsubscribe()})()}onClickAdd(){var t=this;return(0,_.A)(function*(){var i,n,a,c;yield(yield t.actionSheetController.create({mode:"ios",header:t.translateService.instant("app.component.dashboard.edit.header.label"),buttons:[{cssClass:null!==(i=t.lookupService)&&void 0!==i&&null!==(i=i.dashboardList)&&void 0!==i&&i.length?"":"disabledAction",text:t.translateService.instant("app.component.dashboard.add-device.header.label"),icon:"cog-outline",handler:(c=(0,_.A)(function*(){t.openDevices()}),function(){return c.apply(this,arguments)})},{cssClass:null!==(n=t.lookupService)&&void 0!==n&&null!==(n=n.dashboardList)&&void 0!==n&&n.length?"":"disabledAction",text:t.translateService.instant("app.component.dashboard.add-room.header.label"),icon:"home-outline",handler:function(){var c=(0,_.A)(function*(){t.openRooms()});return function(){return c.apply(this,arguments)}}()},{cssClass:null!==(a=t.lookupService)&&void 0!==a&&null!==(a=a.dashboardList)&&void 0!==a&&a.length?"":"disabledAction",text:t.translateService.instant("app.component.dashboard.add-group.header.label"),icon:"copy-outline",handler:function(){var c=(0,_.A)(function*(){t.openGroups()});return function(){return c.apply(this,arguments)}}()},{text:t.translateService.instant("app.component.dashboard.add-dashboard.header.label"),icon:"duplicate-outline",handler:function(){var c=(0,_.A)(function*(){t.addDashboard()});return function(){return c.apply(this,arguments)}}()},{text:t.translateService.instant("app.component.dashboard.cancel.header.label"),role:"cancel",icon:"close",handler:()=>{}}]})).present()})()}openRooms(){var t=this;return(0,_.A)(function*(){t.popoverService.presentModal(ri.C,!0,{dashboard:t.lookupService.dashboardList[t.currentSlide$.value],currentSlide:t.currentSlide$.value},"dashboardModal",!0,void 0,document.querySelector("app-dashboard"))})()}openGroups(){var t=this;return(0,_.A)(function*(){t.popoverService.presentModal(oi.w,!0,{dashboard:t.lookupService.dashboardList[t.currentSlide$.value],currentSlide:t.currentSlide$.value},"dashboardModal",!0,void 0,document.querySelector("app-dashboard"))})()}openDevices(){var t=this;return(0,_.A)(function*(){t.popoverService.presentModal(ni.D,!0,{dashboard:t.lookupService.dashboardList[t.currentSlide$.value],currentSlide:t.currentSlide$.value},"dashboardModal",!0,void 0,document.querySelector("app-dashboard"))})()}addEl(t,i,n){if(n){const l=document.getElementById(t).querySelector("ion-icon");if(l){document.getElementById(t).querySelector(".action-sheet-button-inner").innerHTML="",document.getElementById(t).querySelector(".action-sheet-button-inner").insertAdjacentElement("afterbegin",l),document.getElementById(t).querySelector(".action-sheet-button-inner").insertAdjacentText("afterbegin",this.translateService.instant(i));const c=document.createElement("div");c.innerHTML=null==n?void 0:n.toString(),document.getElementById(t).querySelector(".action-sheet-button-inner").insertAdjacentElement("afterbegin",c),setTimeout(()=>c.classList.add("foundCount"),0)}}else{var a;const l=null===(a=document.getElementById(t))||void 0===a?void 0:a.querySelector("ion-icon");l&&(document.getElementById(t).querySelector(".action-sheet-button-inner").innerHTML="",document.getElementById(t).querySelector(".action-sheet-button-inner").insertAdjacentElement("afterbegin",l),document.getElementById(t).querySelector(".action-sheet-button-inner").insertAdjacentText("afterbegin",this.translateService.instant(i)))}}}return(o=s).\u0275fac=function(t){return new(t||o)(e.rXU(e.sFG),e.rXU(qe.u),e.rXU(oe.u),e.rXU(X.s),e.rXU(u.W3),e.rXU(Se.L),e.rXU(M.c$),e.rXU(Zi.y),e.rXU(K.E),e.rXU(u.IE),e.rXU(u.GD))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-dashboard"]],viewQuery:function(t,i){if(1&t&&(e.GBs(ln,5),e.GBs(u.W9,5)),2&t){let n;e.mGM(n=e.lsd())&&(i.swiperComponent=n.first),e.mGM(n=e.lsd())&&(i.ionContents=n)}},decls:2,vars:3,consts:[["swiperComponent",""],["inView","inView"],["customize",""],["customizeRoom",""],["customizeGroup",""],[4,"ngIf"],["translucent","true",1,"ion-no-border"],["slot","start"],["color","primary",3,"menu"],["slot","icon-only","name","menu-outline"],["color","primary",3,"click","disabled"],["slot","icon-only","name","people-outline",2,"transform","scaleX(-1)"],["color","primary"],["slot","end"],["color","primary",3,"click"],["slot","icon-only",3,"name"],["slot","icon-only","name","add"],["class","badgeCount","mode","ios","color","primary",4,"ngIf"],["slot","icon-only","md","ellipsis-vertical-outline","ios","ellipsis-horizontal-outline"],[2,"--overflow","hidden",3,"fullscreen"],["mode","md","vertical","bottom","horizontal","start","slot","fixed"],["size","small","color","danger",3,"click",4,"ngIf"],["mode","md","vertical","bottom","horizontal","center","slot","fixed",2,"bottom","16px"],["color","primary",3,"click",4,"ngIf"],["mode","md","vertical","bottom","horizontal","end","slot","fixed"],["size","small","color","success",3,"click",4,"ngIf"],["mode","md","vertical","bottom","horizontal","start","slot","fixed",4,"ngIf"],["mode","md","vertical","bottom","horizontal","end","slot","fixed",4,"ngIf"],["cdkScrollable","","scroll-events","",1,"scrollDiv"],[3,"slideChange","config"],[4,"ngFor","ngForOf"],["mode","ios","color","primary",1,"badgeCount"],["size","small","color","danger",3,"click"],["name","trash-outline"],["name","add-outline"],["size","small","color","success",3,"click"],["name","create-outline"],["class","slideFab","size","small","color","transparent",3,"click",4,"ngIf"],["size","small","color","transparent",1,"slideFab",3,"click"],["name","chevron-back-outline"],["name","chevron-forward-outline"],["appSlide","",2,"height","calc(100vh - 67px - var(--ion-safe-area-bottom) - var(--ion-safe-area-top))",3,"click"],[1,"dashboardCol"],["mode","ios",1,"empty"],["appSlide",""],[1,"scrollContent"],["class","dashboardCol","cdkDropList","",3,"width","cdkDropListData","cdkDropListConnectedTo","id","cdkDropListDropped","click",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDropList","",1,"dashboardCol",3,"cdkDropListDropped","click","cdkDropListData","cdkDropListConnectedTo","id"],["mode","ios","class","empty",4,"ngIf"],["cdkDrag","",1,"dragElement",3,"cdkDragData","cdkDragDisabled"],["cdkDrag","",1,"dragElement",3,"cdkDragStarted","cdkDragData","cdkDragDisabled"],["class","remove","color","danger",3,"click",4,"ngIf"],["class","card",4,"ngIf"],["class","wrapper",4,"ngIf"],["color","danger",1,"remove",3,"click"],["name","close",1,"remove-icon"],[1,"card"],["inView","",3,"allow","ping","deviceInfo","dashboardSettings","showDetails","reorder","dashboardSettingsChange",4,"ngIf"],["inView","",3,"dashboardSettingsChange","allow","ping","deviceInfo","dashboardSettings","showDetails","reorder"],["cdkDragHandle","",4,"ngIf"],["cdkDragHandle",""],["name","move-outline"],[1,"controlButton"],["color","success","fill","clear","size","small",1,"smallFab",3,"click"],["name","settings-outline"],[1,"wrapper"],["inView","",3,"ping","room","allow","reorder","collapsed","not-collapsed","dashboardSettings","controlButtons","dashboardSettingsChange","select","controlButtonsChange",4,"ngIf"],["inView","",3,"dashboardSettingsChange","select","controlButtonsChange","ping","room","allow","reorder","collapsed","dashboardSettings","controlButtons"],["inView","",3,"ping","group","allow","reorder","collapsed","collapsedDisplay","not-collapsed","dashboardSettings","controlButtons","dashboardSettingsChange","select","controlButtonsChange",4,"ngIf"],["inView","",3,"dashboardSettingsChange","select","controlButtonsChange","ping","group","allow","reorder","collapsed","dashboardSettings","controlButtons"]],template:function(t,i){1&t&&(e.DNE(0,Bn,38,23,"ng-container",5),e.nI1(1,"async")),2&t&&e.Y8G("ngIf",e.bMT(1,1,i.dashboardList$))},dependencies:[b.Sq,b.bT,u.In,u.Jm,u.QW,u.b_,u.hU,u.W9,u.Q8,u.YW,u.M0,u.lO,u.eU,u.iq,u.nf,u.MC,u.ln,u.BC,u.ai,qi.x,en.F,re.q,se.q,te.Z,de.uv,j.O7,j.T1,j.Fb,tn.M,nn.F,b.Jj,on,rn,Ve.n,sn.Z,an,M.D9],styles:["ion-toolbar[_ngcontent-%COMP%]{--background: transparent;-webkit-backdrop-filter:blur(15px);backdrop-filter:blur(15px)}ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]{background:var(--ion-background-color, #fff)}[_nghost-%COMP%]     app-device   .reorderLabel   p{padding-right:40px}  .header-background{-webkit-backdrop-filter:none!important;backdrop-filter:none!important}.add[_ngcontent-%COMP%]{height:3px;width:calc(50% - 75px);top:50%;position:absolute;max-width:200px}.add.right[_ngcontent-%COMP%]{left:calc(50% + 50px);background:linear-gradient(to left,transparent 0%,var(--ion-color-primary) 60%,var(--ion-color-primary) 100%)}.add.left[_ngcontent-%COMP%]{right:calc(50% + 50px);background:linear-gradient(to right,transparent 0%,var(--ion-color-primary) 60%,var(--ion-color-primary) 100%)}.addText[_ngcontent-%COMP%]{width:100%;color:var(--ion-color-primary);top:calc(50% - 75px);position:absolute;left:0;text-align:center}  .swiper-pagination{position:fixed!important;pointer-events:none}.scrollContent[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content;overflow-y:visible;width:100%;touch-action:pan-y}.card[_ngcontent-%COMP%]{margin:0}.card[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   app-device[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   app-device[_ngcontent-%COMP%]    >div>ion-item{border-radius:4px}.card[_ngcontent-%COMP%]   app-device[_ngcontent-%COMP%]    >div>ion-item::part(native){box-shadow:#0003 0 3px 1px -2px,#00000024 0 2px 2px,#0000001f 0 1px 5px;-webkit-font-smoothing:antialiased;display:block;position:relative;font-family:var(--ion-font-family, inherit);overflow:hidden}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:.3}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dragElement[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drag-handle[_ngcontent-%COMP%]{font-size:31px;position:absolute;right:11px;top:11px;z-index:3;background:var(--ion-color-base)}.cdk-drag-handle[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:absolute;height:100%;width:100%;top:0;left:0}.dragElement[_ngcontent-%COMP%]{position:relative;margin:15px 5px}.dragElement[_ngcontent-%COMP%]:last-child{margin-bottom:calc(50px + var(--ion-safe-area-bottom))}.slideFab[_ngcontent-%COMP%]{--box-shadow: none;--ion-color-base: none !important;--ion-color-contrast: var(--ion-color-primary) !important}ion-toolbar.md[_ngcontent-%COMP%]   .badgeCount[_ngcontent-%COMP%]{position:absolute;top:2px;right:65px;padding:2px 4px;transform:translate(100%)}ion-toolbar.ios[_ngcontent-%COMP%]   .badgeCount[_ngcontent-%COMP%]{position:absolute;top:0;right:58px;padding:2px 4px;transform:translate(100%)}  .ios .action-sheet-icon{position:absolute!important;left:5px}  .ios .action-sheet-button-inner{padding:0 40px}  .ios .action-sheet-button-inner div{background:var(--ion-color-primary);color:var(--background);border-radius:15px;position:absolute;right:5px;min-width:24px;height:28px;line-height:28px;padding:0 6px;font-weight:600;font-size:18px;text-align:center;opacity:1;transition:all .2s ease-in-out}  .ios .action-sheet-button-inner div.foundCount{opacity:1}ion-fab-button.remove[_ngcontent-%COMP%]{position:absolute;transform:scale(.6) translateZ(0);z-index:2;opacity:.8;bottom:-16px;left:calc(50% - 16px);width:35px;height:35px}  .disabledAction{pointer-events:none;opacity:.5}.ios[_ngcontent-%COMP%]   .dashboardCol[_ngcontent-%COMP%]{min-height:calc(100vh - 64px)}.md[_ngcontent-%COMP%]   .dashboardCol[_ngcontent-%COMP%]{min-height:calc(100vh - 70px)}ion-slide[_ngcontent-%COMP%], ion-grid[_ngcontent-%COMP%], ion-list[_ngcontent-%COMP%], ion-col[_ngcontent-%COMP%]{padding-top:0}.controlButton[_ngcontent-%COMP%]{margin-right:-5px;width:45px;display:block;height:40px;padding-top:.1px;position:absolute;right:46px;top:5px;z-index:10}.controlButton[_ngcontent-%COMP%]   .smallFab[_ngcontent-%COMP%]::part(native){background:transparent;box-shadow:none}.controlButton[_ngcontent-%COMP%]   .smallFab[_ngcontent-%COMP%]{margin:3px 3px 3px 5.5px;margin-right:0!important;height:34px;width:34px;opacity:.7;--ion-color-contrast: var(--ion-color-base) !important}.controlButton[_ngcontent-%COMP%]   .smallFab[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{transform:scale(.8)}  .resetTransform{transform:initial!important;border-radius:0!important}  .swiper-pagination{margin-bottom:calc(var(--ion-safe-area-bottom) - 4px)}ion-fab[_ngcontent-%COMP%]{margin-bottom:-12px}  swiper-container{min-height:100%;height:-moz-fit-content!important;height:fit-content!important}  swiper-slide{min-height:-webkit-fill-available}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--min-height: 0;height:0}.scrollDiv[_ngcontent-%COMP%]{height:100%;overflow-y:auto;position:absolute;left:0;width:100%;top:0;padding-top:calc(var(--offset-top))}"],changeDetection:0}),s})()}];let Nn=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[Ee.iI.forChild(Gn),Ee.iI]}),s})();var Ln=p(6126);let Xn=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[b.MD,C.YN,u.bv,Pe,yt,j.ad,de.E9,M.h,Ln.v,Nn]}),s})()}}]);